var __extends=this&&this.__extends||function(e,z){function x(){this.constructor=e}for(var C in z)z.hasOwnProperty(C)&&(e[C]=z[C]);e.prototype=null===z?Object.create(z):(x.prototype=z.prototype,new x)},org;
(function(e){(function(z){(function(x){(function(x){(function(u){(function(t){(function(n){var g=function(){function a(){this.netlib=Module;this.c_dgemm=this.netlib.cwrap("f2c_dgemm",null,"number number number number number number number number number number number number number number number number".split(" "));this.c_dgetrs=this.netlib.cwrap("dgetrs_",null,"number number number number number number number number number".split(" "));this.c_dgetri=this.netlib.cwrap("dgetri_",null,"number number number number number number number".split(" "));
this.c_dorgqr=this.netlib.cwrap("dorgqr_",null,"number number number number number number number number number".split(" "));this.c_dgesdd=this.netlib.cwrap("dgesdd_",null,"number number number number number number number number number number number number number number".split(" "));this.c_dgeqrf=this.netlib.cwrap("dgeqrf_",null,"number number number number number number number number".split(" "));this.c_dgetrf=this.netlib.cwrap("dgetrf_",null,"number number number number number number".split(" "))}
a.prototype.dgemm=function(a,b,d,m,f,q,p,l,h,k,v,g,B,n,y,t){l=this.netlib._malloc(1);v=this.netlib._malloc(1);y=this.netlib._malloc(4);var w=this.netlib._malloc(4),u=this.netlib._malloc(4),x=this.netlib._malloc(8),H=this.netlib._malloc(8*p.length),D=this.netlib._malloc(4),z=this.netlib._malloc(8*k.length),C=this.netlib._malloc(4),E=this.netlib._malloc(8),F=this.netlib._malloc(8*n.length),G=this.netlib._malloc(4);this.netlib.setValue(l,e.mwg.ml.common.matrix.blassolver.blas.BlasHelper.transTypeToChar(a).charCodeAt(0),
"i8");this.netlib.setValue(v,e.mwg.ml.common.matrix.blassolver.blas.BlasHelper.transTypeToChar(b).charCodeAt(0),"i8");this.netlib.setValue(y,d,"i32");this.netlib.setValue(w,m,"i32");this.netlib.setValue(u,f,"i32");this.netlib.setValue(x,q,"double");(new Float64Array(this.netlib.HEAPF64.buffer,H,p.length)).set(p);this.netlib.setValue(D,h,"i32");(new Float64Array(this.netlib.HEAPF64.buffer,z,k.length)).set(k);this.netlib.setValue(C,g,"i32");this.netlib.setValue(E,B,"double");a=new Float64Array(this.netlib.HEAPF64.buffer,
F,n.length);a.set(n);this.netlib.setValue(G,t,"i32");this.c_dgemm(l,v,y,w,u,x,H,D,z,C,E,F,G);n.set(a);this.netlib._free(l);this.netlib._free(v);this.netlib._free(y);this.netlib._free(w);this.netlib._free(u);this.netlib._free(x);this.netlib._free(H);this.netlib._free(D);this.netlib._free(z);this.netlib._free(C);this.netlib._free(E);this.netlib._free(F);this.netlib._free(G)};a.prototype.dgetrs=function(a,b,d,m,f,q,p,l,h,k,v,g){f=this.netlib._malloc(1);l=this.netlib._malloc(4);k=this.netlib._malloc(4);
var B=this.netlib._malloc(8*m.length),n=this.netlib._malloc(4),y=this.netlib._malloc(4*p.length),t=this.netlib._malloc(8*h.length),w=this.netlib._malloc(4),u=this.netlib._malloc(4*g.length);this.netlib.setValue(f,e.mwg.ml.common.matrix.blassolver.blas.BlasHelper.transTypeToChar(a).charCodeAt(0),"i8");this.netlib.setValue(l,b,"i32");this.netlib.setValue(k,d,"i32");(new Float64Array(this.netlib.HEAPF64.buffer,B,m.length)).set(m);this.netlib.setValue(n,q,"i32");(new Int32Array(this.netlib.HEAP32.buffer,
y,p.length)).set(p);a=new Float64Array(this.netlib.HEAPF64.buffer,t,h.length);a.set(h);this.netlib.setValue(w,v,"i32");v=new Int32Array(this.netlib.HEAP32.buffer,u,g.length);v.set(g);this.c_dgetrs(f,l,k,B,n,y,t,w,u);h.set(a);g.set(v);this.netlib._free(f);this.netlib._free(l);this.netlib._free(k);this.netlib._free(B);this.netlib._free(n);this.netlib._free(y);this.netlib._free(t);this.netlib._free(w);this.netlib._free(u)};a.prototype.dgetri=function(a,b,d,m,f,q,p,l,h,k){d=this.netlib._malloc(4);q=this.netlib._malloc(8*
b.length);l=this.netlib._malloc(4);var e=this.netlib._malloc(4*f.length),g=this.netlib._malloc(8*p.length),B=this.netlib._malloc(4),n=this.netlib._malloc(4*k.length);this.netlib.setValue(d,a,"i32");a=new Float64Array(this.netlib.HEAPF64.buffer,q,b.length);a.set(b);this.netlib.setValue(l,m,"i32");(new Int32Array(this.netlib.HEAP32.buffer,e,f.length)).set(f);m=new Float64Array(this.netlib.HEAPF64.buffer,g,p.length);m.set(p);this.netlib.setValue(B,h,"i32");h=new Int32Array(this.netlib.HEAP32.buffer,
n,k.length);h.set(k);this.c_dgetri(d,q,l,e,g,B,n);b.set(a);p.set(m);k.set(h);this.netlib._free(d);this.netlib._free(q);this.netlib._free(l);this.netlib._free(e);this.netlib._free(g);this.netlib._free(B);this.netlib._free(n)};a.prototype.dgetrf=function(a,b,d,m,f,q,p,l){m=this.netlib._malloc(4);p=this.netlib._malloc(4);var h=this.netlib._malloc(8*d.length),k=this.netlib._malloc(4),e=this.netlib._malloc(4*q.length),g=this.netlib._malloc(4*l.length);this.netlib.setValue(m,a,"i32");this.netlib.setValue(p,
b,"i32");a=new Float64Array(this.netlib.HEAPF64.buffer,h,d.length);a.set(d);this.netlib.setValue(k,f,"i32");f=new Int32Array(this.netlib.HEAP32.buffer,e,q.length);f.set(q);b=new Int32Array(this.netlib.HEAP32.buffer,g,l.length);b.set(l);this.c_dgetrf(m,p,h,k,e,g);d.set(a);q.set(f);l.set(b);this.netlib._free(m);this.netlib._free(p);this.netlib._free(h);this.netlib._free(k);this.netlib._free(e);this.netlib._free(g)};a.prototype.dorgqr=function(a,b,d,m,f,q,p,l,h,k,e,g){f=this.netlib._malloc(4);l=this.netlib._malloc(4);
k=this.netlib._malloc(4);var B=this.netlib._malloc(8*m.length),n=this.netlib._malloc(4),y=this.netlib._malloc(8*p.length),t=this.netlib._malloc(8*h.length),w=this.netlib._malloc(4),u=this.netlib._malloc(4*g.length);this.netlib.setValue(f,a,"i32");this.netlib.setValue(l,b,"i32");this.netlib.setValue(k,d,"i32");a=new Float64Array(this.netlib.HEAPF64.buffer,B,m.length);a.set(m);this.netlib.setValue(n,q,"i32");(new Float64Array(this.netlib.HEAPF64.buffer,y,p.length)).set(p);q=new Float64Array(this.netlib.HEAPF64.buffer,
t,h.length);q.set(h);this.netlib.setValue(w,e,"i32");e=new Int32Array(this.netlib.HEAP32.buffer,u,g.length);e.set(g);this.c_dorgqr(f,l,k,B,n,y,t,w,u);m.set(a);h.set(q);g.set(e);this.netlib._free(f);this.netlib._free(l);this.netlib._free(k);this.netlib._free(B);this.netlib._free(n);this.netlib._free(y);this.netlib._free(t);this.netlib._free(w);this.netlib._free(u)};a.prototype.dgeqrf=function(a,b,d,m,f,q,e,l,h,k,v){m=this.netlib._malloc(4);e=this.netlib._malloc(4);h=this.netlib._malloc(8*d.length);
var g=this.netlib._malloc(4),B=this.netlib._malloc(8*q.length),n=this.netlib._malloc(8*l.length),y=this.netlib._malloc(4),t=this.netlib._malloc(4*v.length);this.netlib.setValue(m,a,"i32");this.netlib.setValue(e,b,"i32");a=new Float64Array(this.netlib.HEAPF64.buffer,h,d.length);a.set(d);this.netlib.setValue(g,f,"i32");f=new Float64Array(this.netlib.HEAPF64.buffer,B,q.length);f.set(q);b=new Float64Array(this.netlib.HEAPF64.buffer,n,l.length);b.set(l);this.netlib.setValue(y,k,"i32");k=new Int32Array(this.netlib.HEAP32.buffer,
t,v.length);k.set(v);this.c_dgeqrf(m,e,h,g,B,n,y,t);d.set(a);q.set(f);l.set(b);v.set(k);this.netlib._free(m);this.netlib._free(e);this.netlib._free(h);this.netlib._free(g);this.netlib._free(B);this.netlib._free(n);this.netlib._free(y);this.netlib._free(t)};a.prototype.dgesdd=function(a,b,d,m,f,q,e,l,h,k,v,g,n,A){var y=this.netlib._malloc(1),t=this.netlib._malloc(4),w=this.netlib._malloc(4),u=this.netlib._malloc(8*m.length),x=this.netlib._malloc(4),z=this.netlib._malloc(8*q.length),D=this.netlib._malloc(8*
e.length),C=this.netlib._malloc(4),I=this.netlib._malloc(8*h.length),E=this.netlib._malloc(4),F=this.netlib._malloc(8*v.length),G=this.netlib._malloc(4),J=this.netlib._malloc(4*n.length),K=this.netlib._malloc(4*A.length);this.netlib.setValue(y,a.charCodeAt(0),"i8");this.netlib.setValue(t,b,"i32");this.netlib.setValue(w,d,"i32");a=new Float64Array(this.netlib.HEAPF64.buffer,u,m.length);a.set(m);this.netlib.setValue(x,f,"i32");f=new Float64Array(this.netlib.HEAPF64.buffer,z,q.length);f.set(q);b=new Float64Array(this.netlib.HEAPF64.buffer,
D,e.length);b.set(e);this.netlib.setValue(C,l,"i32");l=new Float64Array(this.netlib.HEAPF64.buffer,I,h.length);l.set(h);this.netlib.setValue(E,k,"i32");k=new Float64Array(this.netlib.HEAPF64.buffer,F,v.length);k.set(v);this.netlib.setValue(G,g,"i32");g=new Int32Array(this.netlib.HEAP32.buffer,J,n.length);g.set(n);d=new Int32Array(this.netlib.HEAP32.buffer,K,A.length);d.set(A);this.c_dgesdd(y,t,w,u,x,z,D,C,I,E,F,G,J,K);m.set(a);q.set(f);e.set(b);h.set(l);v.set(k);n.set(g);A.set(d);this.netlib._free(y);
this.netlib._free(t);this.netlib._free(w);this.netlib._free(u);this.netlib._free(x);this.netlib._free(z);this.netlib._free(D);this.netlib._free(C);this.netlib._free(I);this.netlib._free(E);this.netlib._free(F);this.netlib._free(G);this.netlib._free(J);this.netlib._free(K)};a.prototype.connect=function(){};a.prototype.disconnect=function(){};return a}();n.JSBlas=g})(t.blas||(t.blas={}))})(u.blassolver||(u.blassolver={}))})(x.matrix||(x.matrix={}))})(x.common||(x.common={}))})(z.ml||(z.ml={}))})(e.mwg||
(e.mwg={}))})(org||(org={}));
(function(e){(function(z){(function(x){var z=function(u){function t(e,g,a,c){u.call(this,e,g,a,c)}__extends(t,u);t.requireNotNull=function(e,g){if(null==e)throw Error(g);};t.prototype.illegalArgumentIfFalse=function(e,g){if(!e)throw Error(g);};t.prototype.extractFeatures=function(n){var g=u.prototype.get.call(this,t.FROM);if(null!=g){for(var g=g.split(t.FROM_SEPARATOR),a=Array(g.length),c=0;c<g.length;c++){var b=e.mwg.task.Actions.setWorld(""+this.world());b.setTime(this.time()+"");b.parse(g[c].trim());
a[c]=b}for(var d=new Float64Array(a.length),m=this.graph().newCounter(a.length),b=function(b){var c=e.mwg.task.Actions.newTask().emptyResult();c.add(f);a[b].executeWith(f.graph(),c,function(a){null==a?d[b]=e.mwg.Constants.NULL_LONG:(d[b]=parseFloat(a.get(0).toString()),a.free());m.count()})},f=this,c=0;c<g.length;c++)b(c);m.then(function(){n(d)})}else n(null)};t.FROM_SEPARATOR=";";t.FROM="from";return t}(e.mwg.plugin.AbstractNode);x.AbstractMLNode=z;z=function(u){function t(){u.call(this);this.declareNodeType(e.mwg.ml.algorithm.regression.PolynomialNode.NAME,
function(n,g,a,c){return new e.mwg.ml.algorithm.regression.PolynomialNode(n,g,a,c)});this.declareNodeType(e.mwg.ml.algorithm.profiling.GaussianSlotNode.NAME,function(n,g,a,c){return new e.mwg.ml.algorithm.profiling.GaussianSlotNode(n,g,a,c)});this.declareNodeType(e.mwg.ml.algorithm.profiling.GaussianMixtureNode.NAME,function(n,g,a,c){return new e.mwg.ml.algorithm.profiling.GaussianMixtureNode(n,g,a,c)});this.declareNodeType(e.mwg.ml.algorithm.regression.LiveLinearRegressionNode.NAME,function(n,g,
a,c){return new e.mwg.ml.algorithm.regression.LiveLinearRegressionNode(n,g,a,c)});this.declareNodeType(e.mwg.ml.algorithm.anomalydetector.InterquartileRangeOutlierDetectorNode.NAME,function(n,g,a,c){return new e.mwg.ml.algorithm.anomalydetector.InterquartileRangeOutlierDetectorNode(n,g,a,c)});this.declareNodeType(e.mwg.ml.algorithm.profiling.GaussianTreeNode.NAME,function(n,g,a,c){return new e.mwg.ml.algorithm.profiling.GaussianTreeNode(n,g,a,c)});this.declareNodeType(e.mwg.ml.algorithm.profiling.GaussianNode.NAME,
function(n,g,a,c){return new e.mwg.ml.algorithm.profiling.GaussianNode(n,g,a,c)})}__extends(t,u);return t}(e.mwg.structure.StructurePlugin);x.MLPlugin=z;(function(u){(function(t){var n=function(g){function a(a,b,d,m){g.call(this,a,b,d,m)}__extends(a,g);a.prototype.addValue=function(c){this.illegalArgumentIfFalse(null!=c,"Value must be not null");var b=this.unphasedState(),d=b.getFromKeyWithDefault(a.INPUT_DIM_KEY,a.INPUT_DIM_DEF);0>d&&(d=c.length,b.setFromKey(a.INPUT_DIM_KEY,e.mwg.Type.INT,c.length));
var m=b.getFromKeyWithDefault(a.INTERNAL_VALUE_BUFFER_KEY,new Float64Array(0)),f=m.length/d,q=b.getFromKeyWithDefault(a.BUFFER_SIZE_KEY,a.BUFFER_SIZE_DEF),p=Math.max(0,f+1-q),f=f+1-p,q=new Float64Array(f*d);java.lang.System.arraycopy(m,p*d,q,0,q.length-d);java.lang.System.arraycopy(c,0,q,q.length-d,d);for(var m=new Float64Array(d),p=new Float64Array(d),l=0;l<d;l++){for(var h=new Float64Array(f),k=l,v=0;v<f;v++)h[v]=q[k],k+=d;h.sort();k=h[Math.min(Math.round(f*a.UPPER_PERCENTILE),f-1)];h=h[Math.max(Math.round(f*
a.LOWER_PERCENTILE),0)];v=k-h;m[l]=k+a.RANGE_COEF*v;p[l]=h-a.RANGE_COEF*v;b.setFromKey(a.UPPER_BOUND_KEY_PREFIX+l,e.mwg.Type.DOUBLE,m[l]);b.setFromKey(a.LOWER_BOUND_KEY_PREFIX+l,e.mwg.Type.DOUBLE,p[l])}b.setFromKey(a.INTERNAL_VALUE_BUFFER_KEY,e.mwg.Type.DOUBLE_ARRAY,q);return this.checkValue(c,m,p)};a.prototype.checkValue=function(a,b,d){for(var m=0;m<a.length;m++)if(!(a[m]<=d[m]&&a[m]>=b[m]))return!0;return!1};a.prototype.learn=function(a){var b=this;this.extractFeatures(function(d){d=b.addValue(d);
a(d)})};a.prototype.classify=function(a){var b=this;this.extractFeatures(function(d){for(var m=new Float64Array(d.length),f=new Float64Array(d.length),q=b.unphasedState(),p=0;p<d.length;p++)m[p]=q.getFromKey(e.mwg.ml.algorithm.anomalydetector.InterquartileRangeOutlierDetectorNode.LOWER_BOUND_KEY_PREFIX+p),f[p]=q.getFromKey(e.mwg.ml.algorithm.anomalydetector.InterquartileRangeOutlierDetectorNode.UPPER_BOUND_KEY_PREFIX+p);d=b.checkValue(d,m,f);a(d)})};a.prototype.setProperty=function(c,b,d){a.INTERNAL_VALUE_BUFFER_KEY!==
c&&a.INPUT_DIM_KEY!==c&&(a.enforcer.check(c,b,d),g.prototype.setProperty.call(this,c,b,d))};a.MAX_BUFFER_LIMIT=1E5;a.NAME="InterquartileRangeAnomalyDetection";a.INTERNAL_VALUE_BUFFER_KEY="_valueBuffer";a.BUFFER_SIZE_KEY="BufferSize";a.BUFFER_SIZE_DEF=50;a.INPUT_DIM_KEY="InputDimensions";a.INPUT_DIM_DEF=-1;a.UPPER_PERCENTILE=.75;a.LOWER_PERCENTILE=.25;a.RANGE_COEF=1.5;a.UPPER_BOUND_KEY_PREFIX="UpperBoundDimension";a.LOWER_BOUND_KEY_PREFIX="LowerBoundDimension";a.enforcer=(new e.mwg.utility.Enforcer).asIntWithin(a.BUFFER_SIZE_KEY,
1,a.MAX_BUFFER_LIMIT);return a}(e.mwg.ml.AbstractMLNode);t.InterquartileRangeOutlierDetectorNode=n})(u.anomalydetector||(u.anomalydetector={}));(function(t){var n=function(){function g(a,c){this._data=a;this._processType=c;this.calculateMinMaxAvg();c==g.CENTER_ON_AVG?e.mwg.ml.algorithm.preprocessing.PCA.shiftColumn(this._data,this._avg,!0):c==g.NORMALIZE&&this.normalizeData(this._data);this._svdDecompose=e.mwg.ml.common.matrix.Matrix.defaultEngine().decomposeSVD(this._data,!0);var b=this._svdDecompose.getS();
console.log("Need to retain: "+this.retainDynamic(b)+" / "+a.columns()+" dimensions");console.log("Energy retained: "+this._percentToRetain+" %")}g.prototype.normalizeData=function(a){for(var c,b=0;b<a.columns();b++)if(this._max[b]-this._min[b]<g.EPS)for(var d=0;d<a.rows();d++)a.set(d,b,0);else for(c=1/(this._max[b]-this._min[b]),d=0;d<a.rows();d++)a.set(d,b,(a.get(d,b)-this._avg[b])*c)};g.prototype.inverseNormalizeData=function(a){for(var c,b=0;b<a.columns();b++)if(this._max[b]-this._min[b]<g.EPS)for(var d=
0;d<a.rows();d++)a.set(d,b,this._min[b]);else for(c=this._max[b]-this._min[b],d=0;d<a.rows();d++)a.set(d,b,a.get(d,b)*c+this._avg[b])};g.prototype.calculateMinMaxAvg=function(){this._min=new Float64Array(this._data.columns());this._max=new Float64Array(this._data.columns());this._avg=new Float64Array(this._data.columns());for(var a=0;a<this._data.columns();a++)this._min[a]=this._data.get(0,a),this._max[a]=this._min[a],this._avg[a]=this._min[a];for(var c,b=1;b<this._data.rows();b++)for(a=0;a<this._data.columns();a++)c=
this._data.get(b,a),this._avg[a]+=c,c<this._min[a]?this._min[a]=c:c>this._max[a]&&(this._max[a]=c);for(a=0;a<this._data.columns();a++)this._avg[a]/=this._data.rows()};g.shiftColumn=function(a,c,b){var d=a;b||(d=a.clone());for(a=0;a<d.rows();a++)for(b=0;b<d.columns();b++)d.set(a,b,d.get(a,b)-c[b]);return d};g.inverseShift=function(a,c,b){var d=a;b||(d=a.clone());for(a=0;a<d.rows();a++)for(b=0;b<d.columns();b++)d.set(a,b,d.get(a,b)+c[b]);return d};g.prototype.retainDynamic=function(a){for(var c=0,b=
0;b<a.length;b++)c+=a[b]*a[b];var d,m=0,f=a[1]*a[1]/(a[0]*a[0]);d=a[0]*a[0]+a[1]*a[1];for(b=2;b<a.length;b++){m=f;f=a[b]*a[b]/(a[b-1]*a[b-1]);console.log(b+" "+f/m+" , energy: "+100*d/c+" %");if(.98>f/m)return this._percentToRetain=100*d/c,b;d+=a[b]*a[b]}this._percentToRetain=100*d/c;console.log(a.length+" "+f/m+" , energy: "+100*d/c+" %");console.log("");return a.length};g.retain=function(a,c){for(var b=0,d=0;d<a.length;d++)b+=a[d]*a[d];for(var b=b*c,m=0,d=0;d<a.length;d++)if(m+=a[d]*a[d],m>b)return d+
1;return a.length};g.EPS=1E-30;g.NOPROCESS=0;g.CENTER_ON_AVG=1;g.NORMALIZE=2;return g}();t.PCA=n})(u.preprocessing||(u.preprocessing={}));(function(t){var n=function(g){function a(a,b,d,m){g.call(this,a,b,d,m)}__extends(a,g);a.prototype.setProperty=function(c,b,d){a.enforcer.check(c,b,d);g.prototype.setProperty.call(this,c,b,d)};a.prototype.type=function(c){return c===a.AVG?e.mwg.Type.DOUBLE_ARRAY:c===a.MIN?e.mwg.Type.DOUBLE_ARRAY:c===a.MAX?e.mwg.Type.DOUBLE_ARRAY:c===a.COV?e.mwg.Type.DOUBLE_ARRAY:
c===a.PRECISION?e.mwg.Type.DOUBLE_ARRAY:g.prototype.type.call(this,c)};a.prototype.get=function(c){if(c===a.AVG)return this.getAvg();if(c===a.MIN)return this.getMin();if(c===a.MAX||c===a.MAX)return this.getMax();if(c===a.COV){c=this._resolver.resolveState(this).getFromKey(a.PRECISION);var b=this.getNumberOfFeatures();if(null==c){c=new Float64Array(b);for(var d=0;d<b;d++)c[d]=1}return this.getCovariance(this.getAvg(),c)}return g.prototype.get.call(this,c)};a.prototype.learn=function(a){var b=this;
this.extractFeatures(function(d){b.learnVector(d,a)})};a.prototype.learnVector=function(c,b){var d=this,m=this._resolver.alignState(this),f=m.getFromKeyWithDefault(a.WIDTH,a.WIDTH_DEF),q=m.getFromKeyWithDefault(a.COMPRESSION_FACTOR,a.COMPRESSION_FACTOR_DEF),p=m.getFromKeyWithDefault(a.COMPRESSION_ITER,a.COMPRESSION_ITER_DEF),l=m.getFromKey(a.PRECISION);if(null==l)for(var l=new Float64Array(c.length),h=0;h<c.length;h++)l[h]=1;var k=l,v=m.getFromKeyWithDefault(a.THRESHOLD,a.THRESHOLD_DEF),m=e.mwg.task.Actions.newTask();
m.asGlobalVar("parent").traverse(a.INTERNAL_SUBGAUSSIAN).then(function(a){var b=a.resultAsNodes(),m=a.variable("parent").get(0),b=d.filter(b,c,k,v,m.getLevel()-1);null!=b?(m.internallearn(c,f,q,p,k,v,!1),a.continueWith(a.wrapClone(b))):(m.internallearn(c,f,q,p,k,v,!0),a.continueWith(null))}).ifThen(function(d){return null!=d.result()},m);e.mwg.task.Actions.setTime(this.time()+"").setWorld(this.world()+"").inject(this).subTask(m).execute(this.graph(),function(d){null!=d&&d.free();null!=b&&b(!0)})};
a.prototype.checkInside=function(a,b,d,m,f){m+=.707*f;f=this.getAvg();for(var q=!0,e=this.getCovarianceArray(f,d),l=0;l<a.length;l++)if(e[l]=Math.sqrt(e[l]),f[l]+e[l]<a[l]-m*d[l]||f[l]-e[l]>b[l]+m*d[l]){q=!1;break}return q};a.prototype.filter=function(a,b,d,m,f){m+=.707*f;if(null==a||0==a.size())return null;f=new Float64Array(a.size());for(var q=java.lang.Double.MAX_VALUE,p=0,l=0;l<a.size();l++){var h=a.get(l),k=h.getAvg();f[l]=e.mwg.ml.algorithm.profiling.GaussianMixtureNode.distance(b,k,h.getCovarianceArray(k,
d));f[l]<q&&(q=f[l],p=l)}return q<m?a.get(p):null};a.prototype.predict=function(a){};a.prototype.getLevel=function(){return this._resolver.resolveState(this).getFromKeyWithDefault(a.LEVEL,a.LEVEL_DEF)};a.prototype.getWidth=function(){return this._resolver.resolveState(this).getFromKeyWithDefault(a.WIDTH,a.WIDTH_DEF)};a.prototype.getCompressionFactor=function(){return this._resolver.resolveState(this).getFromKeyWithDefault(a.COMPRESSION_FACTOR,a.COMPRESSION_FACTOR_DEF)};a.prototype.getCompressionIter=
function(){return this._resolver.resolveState(this).getFromKeyWithDefault(a.COMPRESSION_ITER,a.COMPRESSION_ITER_DEF)};a.prototype.updateLevel=function(c){g.prototype.set.call(this,a.LEVEL,c);0==c?g.prototype.set.call(this,a.INTERNAL_SUBGAUSSIAN,new Float64Array(0)):g.prototype.rel.call(this,a.INTERNAL_SUBGAUSSIAN,function(a){for(var d=0;d<a.length;d++)a[d].updateLevel(c-1),a[d].free()})};a.prototype.createLevel=function(c,b,d,m,f,q,e){var l=this.graph().newTypedNode(this.world(),this.time(),a.NAME);
l.set(a.LEVEL,b);l.internallearn(c,d,m,f,q,e,!1);g.prototype.add.call(this,a.INTERNAL_SUBGAUSSIAN,l);return l};a.prototype.checkAndCompress=function(c,b,d,m,f){var q=this,p=g.prototype.get.call(this,a.INTERNAL_SUBGAUSSIAN);null!=p&&0!=p.size()&&p.size()>=b*c&&g.prototype.rel.call(this,a.INTERNAL_SUBGAUSSIAN,function(a){for(var h=Array(a.length),k=Array(a.length),p=0;p<a.length;p++)h[p]=a[p],k[p]=h[p].getAvg();for(var k=(new e.mwg.ml.algorithm.profiling.KMeans).getClusterIds(k,c,d,m),g=Array(c),p=
0;p<c;p++)if(null!=k[p]&&0<k[p].length){for(var n=0,A=0,y=0;y<k[p].length;y++){var t=h[k[p][y]].getTotal();t>n&&(n=t,A=k[p][y])}g[p]=h[A]}for(p=0;p<c;p++)if(1<k[p].length&&1==g[p].getTotal()&&0<g[p].getLevel()&&g[p].createLevel(g[p].getAvg(),g[p].getLevel()-1,c,b,d,m,f).free(),null!=k[p]&&0<k[p].length){for(y=0;y<k[p].length;y++)n=h[k[p][y]],n!=g[p]&&(g[p].move(n),q.remove(e.mwg.ml.algorithm.profiling.GaussianMixtureNode.INTERNAL_SUBGAUSSIAN,n),n.free());g[p].checkAndCompress(c,b,d,m,f)}for(p=0;p<
a.length;p++)a[p].free()})};a.prototype.move=function(c){for(var b=this.getTotal(),d=this.getLevel(),m=this.getSum(),f=this.getMin(),q=this.getMax(),e=this.getSumSquares(),b=b+c.getTotal(),l=c.getSum(),h=c.getMin(),k=c.getMax(),v=c.getSumSquares(),r=0;r<m.length;r++)m[r]+=l[r],h[r]<f[r]&&(f[r]=h[r]),k[r]>q[r]&&(q[r]=k[r]);for(r=0;r<e.length;r++)e[r]+=v[r];this.set(a.INTERNAL_TOTAL_KEY,b);this.set(a.INTERNAL_SUM_KEY,m);this.set(a.INTERNAL_MIN_KEY,f);this.set(a.INTERNAL_MAX_KEY,q);this.set(a.INTERNAL_SUMSQUARE_KEY,
e);if(0<d)if(b=c.get(a.INTERNAL_SUBGAUSSIAN),null==b||0==b.size())c.updateLevel(d-1),g.prototype.add.call(this,a.INTERNAL_SUBGAUSSIAN,c);else for(c=this.getOrCreateRel(a.INTERNAL_SUBGAUSSIAN),r=0;r<b.size();r++)c.add(b.get(r))};a.prototype.query=function(c,b,d,m){var f=this.getNumberOfFeatures();if(0==f)m(null);else{var q=this._resolver.resolveState(this),p=q.getFromKey(a.PRECISION);if(null==p)for(var p=new Float64Array(f),l=0;l<f;l++)p[l]=1;null==b&&(b=this.getMin());null==d&&(d=this.getMax());for(l=
0;l<f;l++)d[l]-b[l]<p[l]&&(b[l]-=p[l],d[l]=b[l]+2*p[l]);var h=b,k=d,g=p,r=q.getFromKeyWithDefault(a.THRESHOLD,a.THRESHOLD_DEF),n=e.mwg.task.Actions.setTime(this.time()+"").setWorld(this.world()+""),A=this.getLevel();n.inject([this]);b=function(d){n.traverseOrKeep(a.INTERNAL_SUBGAUSSIAN);n.select(function(a){return a.checkInside(h,k,g,r,A-d)})};for(l=0;l<this.getLevel()-c;l++)b(l);n.execute(this.graph(),function(d){for(var a=new e.mwg.ml.common.matrix.Matrix(null,f,f),b=0;b<f;b++)a.set(b,b,g[b]);for(var a=
new e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution(null,a,!1),c=new Int32Array(d.size()),q=0,h=Array(d.size()),b=0;b<d.size();b++){var k=d.get(b);c[b]=k.getTotal();var q=q+c[b],l=k.getAvg();2<c[b]?(h[b]=new e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution(l,k.getCovariance(l,g),!1),h[b].setMin(k.getMin()),h[b].setMax(k.getMax())):h[b]=a.clone(l)}d.free();m(new e.mwg.ml.algorithm.profiling.ProbaDistribution(c,h,q))})}};a.prototype.generateDistributions=function(c,b){var d=
this.getNumberOfFeatures();if(0==d)b(null);else{var m=this._resolver.resolveState(this).getFromKey(a.PRECISION);if(null==m)for(var m=new Float64Array(d),f=0;f<d;f++)m[f]=1;var q=m,m=e.mwg.task.Actions.setTime(this.time()+"").setWorld(this.world()+"");m.inject([this]);for(f=0;f<this.getLevel()-c;f++)m.traverseOrKeep(a.INTERNAL_SUBGAUSSIAN);m.then(function(a){for(var m=a.resultAsNodes(),c=new e.mwg.ml.common.matrix.Matrix(null,d,d),f=0;f<d;f++)c.set(f,f,q[f]);for(var c=new e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution(null,
c,!1),g=new Int32Array(m.size()),r=0,n=Array(m.size()),f=0;f<m.size();f++){var A=m.get(f);g[f]=A.getTotal();var r=r+g[f],t=A.getAvg();2<g[f]?(n[f]=new e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution(t,A.getCovariance(t,q),!1),n[f].setMin(A.getMin()),n[f].setMax(A.getMax())):n[f]=c.clone(t)}a.continueTask();b(new e.mwg.ml.algorithm.profiling.ProbaDistribution(g,n,r))});m.execute(this.graph(),null)}};a.prototype.toString=function(){return a.NAME};a.prototype.internallearn=function(c,
b,d,m,f,q,p){var l=c.length,h=!1,k=this.getTotal(),v=this.getLevel();if(0==k){var r=new Float64Array(l);java.lang.System.arraycopy(c,0,r,0,l);this.set(a.INTERNAL_TOTAL_KEY,1);this.set(a.INTERNAL_SUM_KEY,r)}else{var n,A,t;if(1==k){r=g.prototype.get.call(this,a.INTERNAL_SUM_KEY);n=new Float64Array(l);A=new Float64Array(l);java.lang.System.arraycopy(r,0,n,0,l);java.lang.System.arraycopy(r,0,A,0,l);t=new Float64Array(l*(l+1)/2);for(var u=0,w=0;w<l;w++)for(var x=w;x<l;x++)t[u]=r[w]*r[x],u++;p&&0<v&&(w=
this.createLevel(r,v-1,b,d,m,f,q),e.mwg.ml.algorithm.profiling.GaussianMixtureNode.distance(c,r,f)<q&&(h=!0,w.internallearn(c,b,d,m,f,q,p)),w.free())}else r=g.prototype.get.call(this,a.INTERNAL_SUM_KEY),n=g.prototype.get.call(this,a.INTERNAL_MIN_KEY),A=g.prototype.get.call(this,a.INTERNAL_MAX_KEY),t=g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY);for(w=0;w<l;w++)c[w]<n[w]&&(n[w]=c[w]),c[w]>A[w]&&(A[w]=c[w]),r[w]+=c[w];for(w=u=0;w<l;w++)for(x=w;x<l;x++)t[u]+=c[w]*c[x],u++;k++;p&&0<v&&!h&&(w=this.createLevel(c,
v-1,b,d,m,f,q),w.free(),this.checkAndCompress(b,d,m,f,q));this.set(a.INTERNAL_TOTAL_KEY,k);this.set(a.INTERNAL_SUM_KEY,r);this.set(a.INTERNAL_MIN_KEY,n);this.set(a.INTERNAL_MAX_KEY,A);this.set(a.INTERNAL_SUMSQUARE_KEY,t)}};a.prototype.getNumberOfFeatures=function(){return 0==this.getTotal()?0:g.prototype.get.call(this,a.INTERNAL_SUM_KEY).length};a.prototype.getSum=function(){return 0==this.getTotal()?null:g.prototype.get.call(this,a.INTERNAL_SUM_KEY)};a.prototype.getSumSquares=function(){var c=this.getTotal();
if(0==c)return null;if(1==c){for(var c=g.prototype.get.call(this,a.INTERNAL_SUM_KEY),b=c.length,d=new Float64Array(b*(b+1)/2),m=0,f=0;f<b;f++)for(var q=f;q<b;q++)d[m]=c[f]*c[q],m++;return d}return g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY)};a.prototype.getProbability=function(c,b,d){b=g.prototype.get.call(this,a.INTERNAL_SUM_KEY);var m=g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY);b=e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution.getDistribution(b,m,this.getTotal(),
!1);return null==b?0:b.density(c,d)};a.prototype.getProbabilityArray=function(c,b,d){b=new Float64Array(c.length);var m=g.prototype.get.call(this,a.INTERNAL_SUM_KEY),f=g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY),m=e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution.getDistribution(m,f,this.getTotal(),!1);if(null!=m)for(f=0;f<b.length;f++)b[f]=m.density(c[f],d);return b};a.prototype.getTotal=function(){var c=g.prototype.get.call(this,a.INTERNAL_TOTAL_KEY);return null==c?0:c};a.prototype.getAvg=
function(){var c=this.getTotal();if(0==c)return null;if(1==c)return g.prototype.get.call(this,a.INTERNAL_SUM_KEY);for(var b=g.prototype.get.call(this,a.INTERNAL_SUM_KEY),d=0;d<b.length;d++)b[d]/=c;return b};a.prototype.getCovarianceArray=function(c,b){if(null==c){var d=new Float64Array(b.length);java.lang.System.arraycopy(b,0,d,0,b.length);return d}null==b&&(b=new Float64Array(c.length));var d=c.length,m=this.getTotal();if(0==m)return null;if(1<m){var f=new Float64Array(d),q=g.prototype.get.call(this,
a.INTERNAL_SUMSQUARE_KEY),e;e=m/(m-1);for(var l=0,h=0;h<d;h++)f[h]=(q[l]/m-c[h]*c[h])*e,f[h]<b[h]&&(f[h]=b[h]),l+=d-h;return f}d=new Float64Array(b.length);java.lang.System.arraycopy(b,0,d,0,b.length);return d};a.prototype.getCovariance=function(c,b){var d=c.length,m=this.getTotal();if(0==m)return null;null==b&&(b=new Float64Array(c.length));if(1<m){var f=new Float64Array(d*d),q=g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY),p;p=m/(m-1);for(var l=0,h=0;h<d;h++)for(var k=h;k<d;k++)f[h*d+k]=(q[l]/
m-c[h]*c[k])*p,f[k*d+h]=f[h*d+k],l++,f[h*d+h]<b[h]&&(f[h*d+h]=b[h]);return new e.mwg.ml.common.matrix.Matrix(f,d,d)}return null};a.prototype.getMin=function(){var c=this.getTotal();return 0==c?null:1==c?g.prototype.get.call(this,a.INTERNAL_SUM_KEY):g.prototype.get.call(this,a.INTERNAL_MIN_KEY)};a.prototype.getMax=function(){var c=this.getTotal();return 0==c?null:1==c?g.prototype.get.call(this,a.INTERNAL_SUM_KEY):g.prototype.get.call(this,a.INTERNAL_MAX_KEY)};a.prototype.getSubGraph=function(){var c=
g.prototype.get.call(this,a.INTERNAL_SUBGAUSSIAN);if(null==c)return null;for(var b=new Float64Array(c.size()),d=0;d<c.size();d++)b[d]=c.get(d);return b};a.distance=function(a,b,d){for(var m=0,f,q=0;q<a.length;q++)f=(a[q]-b[q])*(a[q]-b[q])/d[q],f>m&&(m=f);return Math.sqrt(m)};a.NAME="GaussianMixtureNode";a.MIN="min";a.MAX="max";a.AVG="avg";a.COV="cov";a.LEVEL="_level";a.LEVEL_DEF=0;a.WIDTH="_width";a.WIDTH_DEF=10;a.COMPRESSION_FACTOR="_compression";a.COMPRESSION_FACTOR_DEF=2;a.COMPRESSION_ITER="_compressioniter";
a.COMPRESSION_ITER_DEF=10;a.THRESHOLD="_threshold";a.THRESHOLD_DEF=3;a.PRECISION="_precision";a.INTERNAL_SUBGAUSSIAN="_subGaussian";a.INTERNAL_SUM_KEY="_sum";a.INTERNAL_SUMSQUARE_KEY="_sumSquare";a.INTERNAL_TOTAL_KEY="_total";a.INTERNAL_MIN_KEY="_min";a.INTERNAL_MAX_KEY="_max";a.enforcer=(new e.mwg.utility.Enforcer).asIntWithin(a.LEVEL,0,1E3).asIntWithin(a.WIDTH,1,1E3).asPositiveDouble(a.COMPRESSION_FACTOR).asPositiveDouble(a.THRESHOLD).asDoubleArray(a.PRECISION);return a}(e.mwg.ml.AbstractMLNode);
t.GaussianMixtureNode=n;n=function(g){function a(a,b,d,m){g.call(this,a,b,d,m)}__extends(a,g);a.prototype.setProperty=function(a,b,d){g.prototype.setProperty.call(this,a,b,d)};a.prototype.type=function(c){return c===a.AVG?e.mwg.Type.DOUBLE_ARRAY:c===a.MIN?e.mwg.Type.DOUBLE_ARRAY:c===a.MAX?e.mwg.Type.DOUBLE_ARRAY:c===a.COV?e.mwg.Type.DOUBLE_ARRAY:g.prototype.type.call(this,c)};a.prototype.get=function(c){if(c===a.AVG)return this.getAvg();if(c===a.MIN)return this.getMin();if(c===a.MAX||c===a.MAX)return this.getMax();
if(c===a.COV){c=this._resolver.resolveState(this).getFromKey(a.PRECISION);var b=this.getNumberOfFeatures();if(null==c){c=new Float64Array(b);for(var d=0;d<b;d++)c[d]=1}return this.getCovariance(this.getAvg(),c)}return g.prototype.get.call(this,c)};a.prototype.learn=function(a){var b=this;this.extractFeatures(function(d){b.learnVector(d,a)})};a.prototype.learnVector=function(c,b){this._resolver.alignState(this);var d=c.length,m=this.getTotal();if(0==m){var f=new Float64Array(d);java.lang.System.arraycopy(c,
0,f,0,d);this.set(a.INTERNAL_TOTAL_KEY,1);this.set(a.INTERNAL_SUM_KEY,f)}else{var q,e,l;if(1==m){f=g.prototype.get.call(this,a.INTERNAL_SUM_KEY);q=new Float64Array(d);e=new Float64Array(d);java.lang.System.arraycopy(f,0,q,0,d);java.lang.System.arraycopy(f,0,e,0,d);l=new Float64Array(d*(d+1)/2);for(var h=0,k=0;k<d;k++)for(var v=k;v<d;v++)l[h]=f[k]*f[v],h++}else f=g.prototype.get.call(this,a.INTERNAL_SUM_KEY),q=g.prototype.get.call(this,a.INTERNAL_MIN_KEY),e=g.prototype.get.call(this,a.INTERNAL_MAX_KEY),
l=g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY);for(k=0;k<d;k++)c[k]<q[k]&&(q[k]=c[k]),c[k]>e[k]&&(e[k]=c[k]),f[k]+=c[k];for(k=h=0;k<d;k++)for(v=k;v<d;v++)l[h]+=c[k]*c[v],h++;m++;this.set(a.INTERNAL_TOTAL_KEY,m);this.set(a.INTERNAL_SUM_KEY,f);this.set(a.INTERNAL_MIN_KEY,q);this.set(a.INTERNAL_MAX_KEY,e);this.set(a.INTERNAL_SUMSQUARE_KEY,l)}null!=b&&b(!0)};a.prototype.predict=function(a){};a.prototype.toString=function(){return a.NAME};a.prototype.getNumberOfFeatures=function(){return 0==this.getTotal()?
0:g.prototype.get.call(this,a.INTERNAL_SUM_KEY).length};a.prototype.getSum=function(){return 0==this.getTotal()?null:g.prototype.get.call(this,a.INTERNAL_SUM_KEY)};a.prototype.getSumSquares=function(){var c=this.getTotal();if(0==c)return null;if(1==c){for(var c=g.prototype.get.call(this,a.INTERNAL_SUM_KEY),b=c.length,d=new Float64Array(b*(b+1)/2),m=0,f=0;f<b;f++)for(var q=f;q<b;q++)d[m]=c[f]*c[q],m++;return d}return g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY)};a.prototype.getProbability=function(c,
b,d){b=g.prototype.get.call(this,a.INTERNAL_SUM_KEY);var m=g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY);b=e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution.getDistribution(b,m,this.getTotal(),!1);return null==b?0:b.density(c,d)};a.prototype.getProbabilityArray=function(c,b,d){b=new Float64Array(c.length);var m=g.prototype.get.call(this,a.INTERNAL_SUM_KEY),f=g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY),m=e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution.getDistribution(m,
f,this.getTotal(),!1);if(null!=m)for(f=0;f<b.length;f++)b[f]=m.density(c[f],d);return b};a.prototype.getTotal=function(){var c=g.prototype.get.call(this,a.INTERNAL_TOTAL_KEY);return null==c?0:c};a.prototype.getAvg=function(){var c=this.getTotal();if(0==c)return null;if(1==c)return g.prototype.get.call(this,a.INTERNAL_SUM_KEY);for(var b=g.prototype.get.call(this,a.INTERNAL_SUM_KEY),d=0;d<b.length;d++)b[d]/=c;return b};a.prototype.getCovarianceArray=function(c,b){if(null==c){var d=new Float64Array(b.length);
java.lang.System.arraycopy(b,0,d,0,b.length);return d}null==b&&(b=new Float64Array(c.length));var d=c.length,m=this.getTotal();if(0==m)return null;if(1<m){var f=new Float64Array(d),q=g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY),e;e=m/(m-1);for(var l=0,h=0;h<d;h++)f[h]=(q[l]/m-c[h]*c[h])*e,f[h]<b[h]&&(f[h]=b[h]),l+=d-h;return f}d=new Float64Array(b.length);java.lang.System.arraycopy(b,0,d,0,b.length);return d};a.prototype.getCovariance=function(c,b){var d=c.length,m=this.getTotal();if(0==m)return null;
null==b&&(b=new Float64Array(c.length));if(1<m){var f=new Float64Array(d*d),q=g.prototype.get.call(this,a.INTERNAL_SUMSQUARE_KEY),p;p=m/(m-1);for(var l=0,h=0;h<d;h++)for(var k=h;k<d;k++)f[h*d+k]=(q[l]/m-c[h]*c[k])*p,f[k*d+h]=f[h*d+k],l++,f[h*d+h]<b[h]&&(f[h*d+h]=b[h]);return new e.mwg.ml.common.matrix.Matrix(f,d,d)}return null};a.prototype.getMin=function(){var c=this.getTotal();return 0==c?null:1==c?g.prototype.get.call(this,a.INTERNAL_SUM_KEY):g.prototype.get.call(this,a.INTERNAL_MIN_KEY)};a.prototype.getMax=
function(){var c=this.getTotal();return 0==c?null:1==c?g.prototype.get.call(this,a.INTERNAL_SUM_KEY):g.prototype.get.call(this,a.INTERNAL_MAX_KEY)};a.distance=function(a,b,d){for(var m=0,f,q=0;q<a.length;q++)f=(a[q]-b[q])*(a[q]-b[q])/d[q],f>m&&(m=f);return Math.sqrt(m)};a.NAME="GaussianNode";a.MIN="min";a.MAX="max";a.AVG="avg";a.COV="cov";a.PRECISION="_precision";a.INTERNAL_SUM_KEY="_sum";a.INTERNAL_SUMSQUARE_KEY="_sumSquare";a.INTERNAL_TOTAL_KEY="_total";a.INTERNAL_MIN_KEY="_min";a.INTERNAL_MAX_KEY=
"_max";return a}(e.mwg.ml.AbstractMLNode);t.GaussianNode=n;n=function(g){function a(a,b,d,m){g.call(this,a,b,d,m)}__extends(a,g);a.prototype.learn=function(a){var b=this;this.extractFeatures(function(d){b.learnArray(d);a(!0)})};a.timeSensitivity=function(a,b){return Math.floor(a/b)*b};a.prototype.learnArray=function(c){var b=this,d=this.time(),m=this.get(a.PERIOD_SIZE),f=new Float64Array([e.mwg.ml.algorithm.profiling.GaussianSlotNode.timeSensitivity(d,m)]);this.timepoints(e.mwg.Constants.BEGINNING_OF_TIME,
e.mwg.Constants.END_OF_TIME,function(d){f[0]<d[0]&&(f[0]=d[0])});this.jump(f[0],function(a){a=a.graph().resolver().resolveState(a);var m=a.getFromKeyWithDefault(e.mwg.ml.algorithm.profiling.GaussianSlotNode.SLOTS_NUMBER,e.mwg.ml.algorithm.profiling.GaussianSlotNode.SLOTS_NUMBER_DEF),f,h,k,g,r,n=c.length;f=a.getFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_TOTAL_KEY);if(1==m||0==m)null==f?(a.setFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_FEATURES_NUMBER,e.mwg.Type.INT,
n),f=new Int32Array(1),h=new Float64Array(n),k=new Float64Array(n),g=new Float64Array(n),r=new Float64Array(n*(n+1)/2)):(h=a.getFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_MIN_KEY),k=a.getFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_MAX_KEY),g=a.getFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_SUM_KEY),r=a.getFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_SUMSQUARE_KEY)),b.update(f,h,k,g,r,c,0,n,0,0);else{null==f?(a.setFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_FEATURES_NUMBER,
e.mwg.Type.INT,n),f=new Int32Array(m+1),h=new Float64Array((m+1)*n),k=new Float64Array((m+1)*n),g=new Float64Array((m+1)*n),r=new Float64Array((m+1)*n*(n+1)/2)):(h=a.getFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_MIN_KEY),k=a.getFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_MAX_KEY),g=a.getFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_SUM_KEY),r=a.getFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_SUMSQUARE_KEY));var t=a.getFromKeyWithDefault(e.mwg.ml.algorithm.profiling.GaussianSlotNode.PERIOD_SIZE,
e.mwg.ml.algorithm.profiling.GaussianSlotNode.PERIOD_SIZE_DEF),t=e.mwg.ml.algorithm.profiling.GaussianSlotNode.getIntTime(d,m,t),u=m*n,x=m*n*(n+1)/2;b.update(f,h,k,g,r,c,t,n,t*n,t*n*(n+1)/2);b.update(f,h,k,g,r,c,m,n,u,x);a.setFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_FEATURES_NUMBER,e.mwg.Type.INT,n);a.setFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_TOTAL_KEY,e.mwg.Type.INT_ARRAY,f);a.setFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_MIN_KEY,
e.mwg.Type.DOUBLE_ARRAY,h);a.setFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_MAX_KEY,e.mwg.Type.DOUBLE_ARRAY,k);a.setFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_SUM_KEY,e.mwg.Type.DOUBLE_ARRAY,g);a.setFromKey(e.mwg.ml.algorithm.profiling.GaussianSlotNode.INTERNAL_SUMSQUARE_KEY,e.mwg.Type.DOUBLE_ARRAY,r)}})};a.prototype.predict=function(c){var b=this.unphasedState(),d=b.getFromKeyWithDefault(a.INTERNAL_FEATURES_NUMBER,0);if(0==d)c(null);else{var m=b.getFromKeyWithDefault(a.SLOTS_NUMBER,
a.SLOTS_NUMBER_DEF),f=b.getFromKeyWithDefault(a.PERIOD_SIZE,a.PERIOD_SIZE_DEF),m=e.mwg.ml.algorithm.profiling.GaussianSlotNode.getIntTime(this.time(),m,f),f=m*d,q=b.getFromKey(a.INTERNAL_TOTAL_KEY),b=b.getFromKey(a.INTERNAL_SUM_KEY),p=new Float64Array(d);if(null!=q&&0!=q[m])for(var l=0;l<d;l++)p[l]=b[l+f]/q[m];c(p)}};a.prototype.setProperty=function(c,b,d){a.enforcer.check(c,b,d);g.prototype.setProperty.call(this,c,b,d)};a.prototype.get=function(c){var b=this._resolver.resolveState(this);return c===
a.SLOTS_NUMBER?b.getFromKeyWithDefault(a.SLOTS_NUMBER,a.SLOTS_NUMBER_DEF):c===a.PERIOD_SIZE?b.getFromKeyWithDefault(a.PERIOD_SIZE,a.PERIOD_SIZE_DEF):g.prototype.get.call(this,c)};a.getIntTime=function(a,b,d){return 1>=b?0:a%d/(d/b)};a.prototype.update=function(a,b,d,m,f,q,e,l,h,k){if(1==a[e])for(var g=0,r=0;r<l;r++){b[h+r]=q[r];d[h+r]=q[r];m[h+r]=q[r];for(var n=r;n<l;n++)f[k+g]+=q[r]*q[n],g++}else for(r=g=0;r<l;r++)for(q[r]<b[h+r]&&(b[h+r]=q[r]),q[r]>d[h+r]&&(d[h+r]=q[r]),m[h+r]+=q[r],n=r;n<l;n++)f[k+
g]+=q[r]*q[n],g++;a[e]+=1};a.prototype.getMin=function(){return this.unphasedState().getFromKey(a.INTERNAL_MIN_KEY)};a.prototype.getMax=function(){return this.unphasedState().getFromKey(a.INTERNAL_MAX_KEY)};a.prototype.getSum=function(){return this.unphasedState().getFromKey(a.INTERNAL_SUM_KEY)};a.prototype.getSumSquare=function(){return this.unphasedState().getFromKey(a.INTERNAL_SUMSQUARE_KEY)};a.prototype.getTotal=function(){return this.unphasedState().getFromKey(a.INTERNAL_TOTAL_KEY)};a.prototype.getAvg=
function(){var c=this.unphasedState(),b=c.getFromKeyWithDefault(a.SLOTS_NUMBER,a.SLOTS_NUMBER_DEF),d=c.getFromKeyWithDefault(a.INTERNAL_FEATURES_NUMBER,0);if(0==d)return null;var m=c.getFromKey(a.INTERNAL_TOTAL_KEY),c=c.getFromKey(a.INTERNAL_SUM_KEY),f=new Float64Array(c.length);if(null!=m)if(1<b)for(var q=0,e=0;e<b+1;e++)if(0!=m[e])for(var l=0;l<d;l++)f[q]=c[q]/m[e],q++;else q+=d;else if(0!=m[0])for(l=0;l<d;l++)f[l]=c[l]/m[0];return f};a.NAME="GaussianSlotProfiling";a.SLOTS_NUMBER="SLOTS_NUMBER";
a.SLOTS_NUMBER_DEF=1;a.PERIOD_SIZE="PERIOD_SIZE";a.PERIOD_SIZE_DEF=864E5;a.INTERNAL_FEATURES_NUMBER="_featuresNb";a.INTERNAL_TOTAL_KEY="_total";a.INTERNAL_MIN_KEY="_min";a.INTERNAL_MAX_KEY="_max";a.INTERNAL_SUM_KEY="_sum";a.INTERNAL_SUMSQUARE_KEY="_sumSquare";a.enforcer=(new e.mwg.utility.Enforcer).asPositiveInt(a.SLOTS_NUMBER).asPositiveLong(a.PERIOD_SIZE);return a}(e.mwg.ml.AbstractMLNode);t.GaussianSlotNode=n;n=function(g){function a(a,b,d,m){g.call(this,a,b,d,m)}__extends(a,g);a.prototype.learn=
function(a){var b=this;this.extractFeatures(function(d){var m=new Float64Array(d.length-1);java.lang.System.arraycopy(d,0,m,0,d.length-1);b.internalLearn(d,m,a)})};a.prototype.internalLearn=function(a,b,d){var m=this,f=this._resolver.alignState(this);g.prototype.learnVector.call(this,a,function(q){var p=f.getFromKeyWithDefault(e.mwg.ml.algorithm.profiling.GaussianTreeNode.THRESHOLD,e.mwg.ml.algorithm.profiling.GaussianTreeNode.THRESHOLD_DEF);f.getFromKey(e.mwg.ml.algorithm.profiling.GaussianNode.PRECISION);
if(null==f.getFromKey(e.mwg.ml.algorithm.profiling.GaussianTreeNode.INTERNAL_KDROOT)){var l=m.graph().newTypedNode(m.world(),m.time(),e.mwg.structure.tree.KDTree.NAME);l.setProperty(e.mwg.structure.tree.KDTree.DISTANCE_THRESHOLD,e.mwg.Type.DOUBLE,p);m.add(e.mwg.ml.algorithm.profiling.GaussianTreeNode.INTERNAL_KDROOT,l);var h=m.graph().newTypedNode(m.world(),m.time(),e.mwg.ml.algorithm.profiling.GaussianNode.NAME);h.learnVector(a,function(a){l.insertWith(b,h,function(a){l.free();h.free();null!=d&&
d(!0)})})}else m.rel(e.mwg.ml.algorithm.profiling.GaussianTreeNode.INTERNAL_KDROOT,function(f){var q=f[0];q.nearestNWithinRadius(b,1,p,function(f){if(null!=f&&0<f.length){var h=f[0];h.learnVector(a,function(a){q.free();h.free();null!=d&&d(!0)})}else{var k=m.graph().newTypedNode(m.world(),m.time(),e.mwg.ml.algorithm.profiling.GaussianNode.NAME);k.learnVector(a,function(a){q.insertWith(b,k,function(a){q.free();k.free();null!=d&&d(!0)})})}})})})};a.prototype.getNumNodes=function(){var c=new Int32Array(1);
this.rel(a.INTERNAL_KDROOT,function(a){c[0]=null==a||0==a.length?0:a[0].get(e.mwg.structure.tree.KDTree.SIZE)});return c[0]};a.prototype.predict=function(a){};a.prototype.predictValue=function(c,b){var d=this;if(null!=b){var m=new Float64Array(c.length-1);java.lang.System.arraycopy(c,0,m,0,c.length-1);var f=this._resolver.resolveState(this);null==f.getFromKey(a.INTERNAL_KDROOT)&&b(null);var q=f.getFromKeyWithDefault(a.THRESHOLD,a.THRESHOLD_DEF);this.rel(a.INTERNAL_KDROOT,function(a){var c=a[0];c.nearestNWithinRadius(m,
1,q,function(a){if(null!=a&&0<a.length){a=a[0];var m=a.getAvg(),m=m[m.length-1];a.free()}else m=d.getAvg(),m=m[m.length-1];c.free();b(m)})})}};a.NAME="GaussianTreeNode";a.THRESHOLD="_threshold";a.THRESHOLD_DEF=1.01;a.INTERNAL_KDROOT="kdroot";return a}(e.mwg.ml.algorithm.profiling.GaussianNode);t.GaussianTreeNode=n;n=function(){function g(){}g.prototype.getClusterIds=function(a,c,b,d){for(var m=Array(c),f=a[0].length,q=new Int32Array(c),e=Array(c),l=0;l<c;l++)e[l]=new Float64Array(f);for(var h=new Int32Array(a.length),
l=0;l<c;l++)java.lang.System.arraycopy(a[l],0,e[l],0,f);for(var k=0;k<b;k++){for(l=0;l<q.length;l++)q[l]=0;for(l=0;l<a.length;l++)h[l]=this.calculateCategory(a[l],e,d),q[h[l]]++;for(l=0;l<e.length;l++)for(var g=0;g<f;g++)e[l][g]=0;for(l=0;l<a.length;l++)for(g=0;g<f;g++)e[h[l]][g]+=a[l][g];for(l=0;l<e.length;l++)if(0!=q[l])for(g=0;g<f;g++)e[l][g]/=q[l];else g=new java.util.Random,g=a[g.nextInt(a.length)],java.lang.System.arraycopy(g,0,e[l],0,f)}for(l=0;l<c;l++)for(m[l]=new Int32Array(q[l]),g=b=0;g<
a.length;g++)h[g]==l&&(m[l][b]=g,b++);return m};g.prototype.calculateCategory=function(a,c,b){for(var d=java.lang.Double.MAX_VALUE,m=0,f=0;f<c.length;f++){var q=e.mwg.ml.algorithm.profiling.KMeans.distance(a,c[f],b);q<d&&(d=q,m=f)}return m};g.distance=function(a,c,b){for(var d=0,m,f=0;f<a.length;f++)m=(a[f]-c[f])*(a[f]-c[f])/b[f],m>d&&(d=m);return Math.sqrt(d)};return g}();t.KMeans=n;n=function(){function g(a,c,b){this.total=a;this.distributions=c;this.global=b}g.prototype.calculate=function(a){var c=
0;if(null!=this.total)for(var b=0;b<this.distributions.length;b++)5>e.mwg.ml.algorithm.profiling.KMeans.distance(a,this.distributions[b].getAvg(),this.distributions[b].getCovDiag())&&(c+=this.distributions[b].density(a,!1)*this.total[b]/this.global);else for(b=0;b<this.distributions.length;b++)5>e.mwg.ml.algorithm.profiling.KMeans.distance(a,this.distributions[b].getAvg(),this.distributions[b].getCovDiag())&&(c+=this.distributions[b].density(a,!1)/this.global);1<c&&(c=1);return c};g.prototype.calculateArray=
function(a,c){null!=c&&c.updateInformation("Number of distributions: "+this.distributions.length+" , values: "+this.global);for(var b=new Float64Array(a.length),d=0,m=0;m<a.length;m++)if(b[m]=this.calculate(a[m]),d+=b[m],null!=c){var f=1/a.length*m,f=50*f+50;c.updateProgress(f);if(c.isCancelled())return null}if(0!=d)for(m=0;m<a.length;m++)b[m]/=d;return b};g.prototype.addUpProbabilities=function(a){for(var c=0,b=0;b<a.length;b++)c+=this.calculate(a[b]);return c};g.prototype.compareProbaDistribution=
function(a,c){for(var b=new Float64Array(2),d=this.calculateArray(c,null),m=a.calculateArray(c,null),f,q=0;q<d.length;q++)f=Math.abs(d[q]-m[q]),b[0]+=f,f>b[1]&&(b[1]=f);b[0]/=d.length;return b};return g}();t.ProbaDistribution=n})(u.profiling||(u.profiling={}));(function(t){var n=function(g){function a(a,b,d,m){g.call(this,a,b,d,m)}__extends(a,g);a.prototype.learn=function(a,b){var d=this;this.extractFeatures(function(m){d.internalLearn(m,a,b)})};a.prototype.internalLearn=function(c,b,d){var m=this._resolver.alignState(this),
f=m.getFromKeyWithDefault(a.ITERATION_KEY,a.ITERATION_DEF),q=m.getFromKeyWithDefault(a.ALPHA_KEY,a.ALPHA_DEF),p=m.getFromKeyWithDefault(a.LAMBDA_KEY,a.LAMBDA_DEF),l=m.getFromKey(a.WEIGHT_KEY);if(null==l)for(var l=new Float64Array(c.length+1),h=new java.util.Random,k=0;k<l.length;k++)l[k]=.001*h.nextDouble();m.getFromKeyWithDefault(a.LAST_ERR_KEY,0);k=this.calculate(l,c)-b;m.setFromKey(a.LAST_ERR_KEY,e.mwg.Type.DOUBLE,k);if(null==c||l.length!=c.length+1)throw Error(a.MISMATCH_MSG);for(var h=c.length,
g=0;g<f;g++){for(var r=this.calculate(l,c)-b,k=0;k<h;k++)l[k]-=q*(r*c[k]+p*l[k]);l[h]-=q*r}b=m.getFromKey(a.INTERNAL_WEIGHT_BACKUP_KEY);if(null==b)m.setFromKey(a.WEIGHT_KEY,e.mwg.Type.DOUBLE_ARRAY,l),m.setFromKey(a.INTERNAL_WEIGHT_BACKUP_KEY,e.mwg.Type.DOUBLE_ARRAY,l),m.setFromKey(a.INTERNAL_TOTAL_KEY,e.mwg.Type.INT,1);else{for(k=c=0;k<l.length;k++)c=Math.max(c,Math.abs(l[k]-b[k]));k=m.getFromKeyWithDefault(a.THRESHOLD_KEY,a.THRESHOLD_DEF);c>k?(m=this.phasedState(),m.setFromKey(a.WEIGHT_KEY,e.mwg.Type.DOUBLE_ARRAY,
l),m.setFromKey(a.INTERNAL_WEIGHT_BACKUP_KEY,e.mwg.Type.DOUBLE_ARRAY,l),m.setFromKey(a.INTERNAL_TOTAL_KEY,e.mwg.Type.INT,1)):(m.setFromKey(a.WEIGHT_KEY,e.mwg.Type.DOUBLE_ARRAY,l),m.setFromKey(a.INTERNAL_TOTAL_KEY,e.mwg.Type.INT,m.getFromKey(a.INTERNAL_TOTAL_KEY)+1))}null!=d&&d(!0)};a.prototype.setProperty=function(c,b,d){a.enforcer.check(c,b,d);g.prototype.setProperty.call(this,c,b,d)};a.prototype.calculate=function(a,b){for(var d=0,m=0;m<b.length;m++)d+=a[m]*b[m];return d+=a[b.length]};a.prototype.extrapolate=
function(c){var b=this,d=this._resolver.resolveState(this).getFromKey(a.WEIGHT_KEY);null==d?null!=c&&c(0):this.extractFeatures(function(a){if(a.length!=d.length-1)throw Error(e.mwg.ml.algorithm.regression.LiveLinearRegressionNode.MISMATCH_MSG);null!=c&&c(b.calculate(d,a))})};a.ALPHA_KEY="ALPHA";a.ALPHA_DEF=1E-4;a.LAMBDA_KEY="LAMBDA";a.LAMBDA_DEF=1E-5;a.ITERATION_KEY="ITERATION";a.ITERATION_DEF=5;a.THRESHOLD_KEY="THRESHOLD";a.THRESHOLD_DEF=.01;a.LAST_ERR_KEY="_ERR";a.WEIGHT_KEY="_WEIGHT";a.INTERNAL_TOTAL_KEY=
"_TOTAL_KEY";a.INTERNAL_WEIGHT_BACKUP_KEY="_WEIGHTBACKUP";a.MISMATCH_MSG="Different Imput lengths are not supported";a.NAME="LiveLinearRegression";a.enforcer=(new e.mwg.utility.Enforcer).asDouble(a.ALPHA_KEY).asDouble(a.LAMBDA_KEY).asInt(a.ITERATION_KEY);return a}(e.mwg.ml.AbstractMLNode);t.LiveLinearRegressionNode=n;n=function(g){function a(a,b,d,m){g.call(this,a,b,d,m)}__extends(a,g);a.prototype.setProperty=function(c,b,d){if(c===a.VALUE)this.learn(parseFloat(d.toString()),null);else if(c===a.PRECISION)a.enforcer.check(c,
b,d),g.prototype.setProperty.call(this,c,b,d);else throw Error(a.NOT_MANAGED_ATT_ERROR);};a.prototype.get=function(c){if(c===a.VALUE){var b=[null];this.extrapolate(function(d){b[0]=d});return b[0]}return g.prototype.get.call(this,c)};a.prototype.learn=function(c,b){var d=this.unphasedState(),m=d.time(),f=this.time(),q=d.getFromKeyWithDefault(a.PRECISION,a.PRECISION_DEF),p=d.getFromKey(a.INTERNAL_WEIGHT_KEY);if(null==p)p=new Float64Array(1),p[0]=c,d.setFromKey(a.INTERNAL_WEIGHT_KEY,e.mwg.Type.DOUBLE_ARRAY,
p),d.setFromKey(a.INTERNAL_NB_PAST_KEY,e.mwg.Type.INT,1),d.setFromKey(a.INTERNAL_STEP_KEY,e.mwg.Type.LONG,0),d.setFromKey(a.INTERNAL_LAST_TIME_KEY,e.mwg.Type.LONG,0),d.setFromKey(a.INTERNAL_TIME_BUFFER,e.mwg.Type.DOUBLE_ARRAY,new Float64Array([0])),d.setFromKey(a.INTERNAL_VALUES_BUFFER,e.mwg.Type.DOUBLE_ARRAY,new Float64Array([c])),null!=b&&b(!0);else{var l=m+d.getFromKey(a.INTERNAL_LAST_TIME_KEY);if(f>l){var h=d.getFromKey(a.INTERNAL_STEP_KEY),k=f-m;if(null==h||0==h){if(0==k){p=new Float64Array(1);
p[0]=c;d.setFromKey(a.INTERNAL_WEIGHT_KEY,e.mwg.Type.DOUBLE_ARRAY,p);d.setFromKey(a.INTERNAL_TIME_BUFFER,e.mwg.Type.DOUBLE_ARRAY,new Float64Array([0]));d.setFromKey(a.INTERNAL_VALUES_BUFFER,e.mwg.Type.DOUBLE_ARRAY,new Float64Array([c]));null!=b&&b(!0);return}h=k;d.setFromKey(a.INTERNAL_STEP_KEY,e.mwg.Type.LONG,h)}var g=p.length-1,r=d.getFromKey(a.INTERNAL_NB_PAST_KEY),n;n=(f-m)/h;var m=this.maxErr(q,g),h=d.getFromKeyWithDefault(a.MAX_DEGREE,a.MAX_DEGREE_DEF),t=e.mwg.ml.algorithm.regression.PolynomialNode.updateBuffer(d,
n,h,a.INTERNAL_TIME_BUFFER),u=e.mwg.ml.algorithm.regression.PolynomialNode.updateBuffer(d,c,h,a.INTERNAL_VALUES_BUFFER);if(Math.abs(e.mwg.ml.common.matrix.operation.PolynomialFit.extrapolate(n,p)-c)<=m)d.setFromKey(a.INTERNAL_NB_PAST_KEY,e.mwg.Type.INT,r+1),d.setFromKey(a.INTERNAL_LAST_TIME_KEY,e.mwg.Type.LONG,k);else{for(p=Math.min(t.length,h);g<p&&t.length<4*h;){m=this.maxErr(q,g);n=new e.mwg.ml.common.matrix.operation.PolynomialFit(g);n.fit(t,u);if(this.tempError(n.getCoef(),t,u)<=m){p=n.getCoef();
d.setFromKey(a.INTERNAL_NB_PAST_KEY,e.mwg.Type.INT,r+1);d.setFromKey(a.INTERNAL_WEIGHT_KEY,e.mwg.Type.DOUBLE_ARRAY,p);d.setFromKey(a.INTERNAL_LAST_TIME_KEY,e.mwg.Type.LONG,k);null!=b&&b(!0);return}g++}f-=l;l=this.newState(l);k=new Float64Array(2);g=new Float64Array(2);g[0]=0;g[1]=1;k[0]=u[u.length-2];k[1]=c;m=this.maxErr(q,0);Math.abs(k[1]-k[0])<=m?(p=new Float64Array(1),p[0]=k[0]):(p=new Float64Array(2),p[0]=k[0],p[1]=k[1]-k[0]);d.setFromKey(a.INTERNAL_TIME_BUFFER,e.mwg.Type.DOUBLE_ARRAY,null);d.setFromKey(a.INTERNAL_VALUES_BUFFER,
e.mwg.Type.DOUBLE_ARRAY,null);l.setFromKey(a.INTERNAL_TIME_BUFFER,e.mwg.Type.DOUBLE_ARRAY,g);l.setFromKey(a.INTERNAL_VALUES_BUFFER,e.mwg.Type.DOUBLE_ARRAY,k);l.setFromKey(a.PRECISION,e.mwg.Type.DOUBLE,q);l.setFromKey(a.MAX_DEGREE,e.mwg.Type.INT,h);l.setFromKey(a.INTERNAL_WEIGHT_KEY,e.mwg.Type.DOUBLE_ARRAY,p);l.setFromKey(a.INTERNAL_NB_PAST_KEY,e.mwg.Type.INT,2);l.setFromKey(a.INTERNAL_STEP_KEY,e.mwg.Type.LONG,f);l.setFromKey(a.INTERNAL_LAST_TIME_KEY,e.mwg.Type.LONG,f)}null!=b&&b(!0)}else null!=b&&
b(!1)}};a.updateBuffer=function(a,b,d,m){var f=a.getFromKey(m);if(null==f)return f=new Float64Array(1),f[0]=b,a.setFromKey(m,e.mwg.Type.DOUBLE_ARRAY,f),f;f.length<4*d?(d=new Float64Array(f.length+1),java.lang.System.arraycopy(f,0,d,0,f.length),d[f.length]=b):(d=new Float64Array(f.length),java.lang.System.arraycopy(f,1,d,0,f.length-1),d[f.length-1]=b);a.setFromKey(m,e.mwg.Type.DOUBLE_ARRAY,d);return d};a.prototype.extrapolate=function(c){var b=this.time(),d=this.unphasedState(),m=d.time(),f=d.getFromKey(a.INTERNAL_WEIGHT_KEY);
if(null==f)null!=c&&c(0);else{var q=d.getFromKey(a.INTERNAL_STEP_KEY);null==q||0==q?null!=c&&c(f[0]):(b-=m,d=d.getFromKey(a.INTERNAL_LAST_TIME_KEY),b>d&&(b=d),null!=c&&c(e.mwg.ml.common.matrix.operation.PolynomialFit.extrapolate(b/q,f)))}};a.prototype.maxErr=function(a,b){return a/Math.pow(2,b+1)};a.prototype.tempError=function(a,b,d){for(var m=0,f,q=0;q<b.length;q++)f=Math.abs(d[q]-e.mwg.ml.common.matrix.operation.PolynomialFit.extrapolate(b[q],a)),f>m&&(m=f);return m};a.prototype.toString=function(){var c=
new java.lang.StringBuilder;c.append('{"world":');c.append(this.world());c.append(',"time":');c.append(this.time());c.append(',"id":');c.append(this.id());var b=this._resolver.resolveState(this);if(null!=b){b=b.getFromKey(a.INTERNAL_WEIGHT_KEY);if(null!=b){c.append('"polynomial":"');for(var d=0;d<b.length;d++)0!=d&&c.append("+("),c.append(b[d]),1==d?c.append("*t"):1<d&&(c.append("*t^"),c.append(d)),0!=d&&c.append(")");c.append('"')}c.append("}")}return c.toString()};a.PRECISION="precision";a.PRECISION_DEF=
1;a.VALUE="value";a.NAME="PolynomialNode";a.INTERNAL_WEIGHT_KEY="weight";a.INTERNAL_STEP_KEY="step";a.INTERNAL_TIME_BUFFER="times";a.INTERNAL_VALUES_BUFFER="values";a.INTERNAL_NB_PAST_KEY="nb";a.INTERNAL_LAST_TIME_KEY="lastTime";a.MAX_DEGREE="maxdegree";a.MAX_DEGREE_DEF=20;a.NOT_MANAGED_ATT_ERROR="Polynomial node can only handle value attribute, please use a super node to store other data";a.enforcer=(new e.mwg.utility.Enforcer).asPositiveDouble(a.PRECISION);return a}(e.mwg.ml.AbstractMLNode);t.PolynomialNode=
n})(u.regression||(u.regression={}))})(x.algorithm||(x.algorithm={}));(function(u){var t=function(){function n(){}n.deserializeFromDoubleArray=function(g){return e.mwg.ml.common.DecisionTreeNode.deserializeFromDoubleArrayWithRoot(g,0)};n.deserializeFromDoubleArrayWithRoot=function(g,a){var c=new e.mwg.ml.common.DecisionTreeNode;c.boundary=g[a*n.ELEMENTS_PER_NODE];c.classNum=g[a*n.ELEMENTS_PER_NODE+1];var b=g[a*n.ELEMENTS_PER_NODE+2];c.left=0<b?e.mwg.ml.common.DecisionTreeNode.deserializeFromDoubleArrayWithRoot(g,
b):null;b=g[a*n.ELEMENTS_PER_NODE+3];c.right=0<b?e.mwg.ml.common.DecisionTreeNode.deserializeFromDoubleArrayWithRoot(g,b):null;c.featureNum=g[a*n.ELEMENTS_PER_NODE+4];return c};n.prototype.serializeToDoubleArray=function(){for(var e=this.serializeToDoubleObjectArray(),a=new Float64Array(e.size()),c=0;c<a.length;c++)a[c]=e.get(c);return a};n.prototype.serializeToDoubleObjectArray=function(){var e=new java.util.ArrayList,a=new java.util.ArrayList;a.add(this);for(var c=0;0<a.size();){var b=a.get(0);
a.remove(0);e.add(b.boundary);e.add(b.classNum);null!=b.left?(c++,e.add(c),a.add(b.left)):e.add(-1);null!=b.right?(c++,e.add(c),a.add(b.right)):e.add(-1);e.add(b.featureNum)}return e};n.ELEMENTS_PER_NODE=5;return n}();u.DecisionTreeNode=t;(function(e){var g=function(){function a(a){this.err=a}a.prototype.measure=function(a,b){for(var d=0,m,f=0;f<a.length;f++)m=(a[f]-b[f])*(a[f]-b[f])/this.err[f],m>d&&(d=m);return Math.sqrt(d)};a.prototype.compare=function(a,b){return a<b};a.prototype.getMinValue=
function(){return 0};a.prototype.getMaxValue=function(){return java.lang.Double.MAX_VALUE};return a}();e.GaussianDistance=g})(u.distance||(u.distance={}));(function(n){var g=function(){function a(){this.blas=new e.mwg.ml.common.matrix.blassolver.BlasMatrixEngine;this.jama=new e.mwg.ml.common.matrix.jamasolver.JamaMatrixEngine}a.prototype.multiplyTransposeAlphaBeta=function(c,b,d,m,f,e,p){return d.leadingDimension()<a.MULT_LIMIT&&f.leadingDimension()<a.MULT_LIMIT?this.jama.multiplyTransposeAlphaBeta(c,
b,d,m,f,e,p):this.blas.multiplyTransposeAlphaBeta(c,b,d,m,f,e,p)};a.prototype.invert=function(c,b){return c.rows()<a.INVERT_LIMIT?this.jama.invert(c,b):this.blas.invert(c,b)};a.prototype.pinv=function(a,b){var d=new e.mwg.ml.common.matrix.operation.PInvSVD;d.factor(a,b);return d.getPInv()};a.prototype.solveLU=function(c,b,d,m){return c.leadingDimension()<a.SOLVELU_LIMIT&&b.leadingDimension()<a.SOLVELU_LIMIT?this.jama.solveLU(c,b,d,m):this.blas.solveLU(c,b,d,m)};a.prototype.solveQR=function(a,b,d,
m){return this.blas.solveQR(a,b,d,m)};a.prototype.decomposeSVD=function(a,b){return this.jama.decomposeSVD(a,b)};a.MULT_LIMIT=12;a.INVERT_LIMIT=6;a.PINV_LIMIT=5;a.SOLVELU_LIMIT=6;a.SOLVEQR_LIMIT=10;a.SOLVESVD_LIMIT=8;return a}();n.HybridMatrixEngine=g;g=function(){function a(a,b,d){this._nbRows=b;this._nbColumns=d;this._data=null!=a?a:new Float64Array(this._nbRows*this._nbColumns)}a.compare=function(a,b,d){if(null==a||null==b)return!1;for(var m=0;m<a.length;m++)if(Math.abs(a[m]-b[m])>d)return!1;return!0};
a.compareArray=function(a,b,d){if(null==a||null==b)return!1;for(var m=0;m<a.length;m++)if(!e.mwg.ml.common.matrix.Matrix.compare(a[m],b[m],d))return!1;return!0};a.prototype.data=function(){return this._data};a.prototype.exportRowMatrix=function(){for(var a=new Float64Array(this._data.length),b=0,d=0;d<this._nbRows;d++)for(var m=0;m<this._nbColumns;m++)a[b]=this.get(d,m),b++;return a};a.prototype.importRowMatrix=function(a,b,d){b=new e.mwg.ml.common.matrix.Matrix(null,b,d);for(var m=d=0;m<this._nbRows;m++)for(var f=
0;f<this._nbColumns;f++)b.set(m,f,a[d]),d++;return b};a.prototype.setData=function(a){java.lang.System.arraycopy(a,0,this._data,0,a.length)};a.prototype.rows=function(){return this._nbRows};a.prototype.columns=function(){return this._nbColumns};a.prototype.get=function(a,b){return this._data[a+b*this._nbRows]};a.prototype.set=function(a,b,d){return this._data[a+b*this._nbRows]=d};a.prototype.add=function(a,b,d){return this.set(a,b,this.get(a,b)+d)};a.prototype.setAll=function(a){for(var b=0;b<this._nbColumns*
this._nbRows;b++)this._data[b]=a};a.prototype.getAtIndex=function(a){return this._data[a]};a.prototype.setAtIndex=function(a,b){return this._data[a]=b};a.prototype.addAtIndex=function(a,b){this._data[a]+=b;return this._data[a]};a.prototype.clone=function(){var a=new Float64Array(this._data.length);java.lang.System.arraycopy(this._data,0,a,0,this._data.length);return new e.mwg.ml.common.matrix.Matrix(a,this._nbRows,this._nbColumns)};a.defaultEngine=function(){null==a._defaultEngine&&(a._defaultEngine=
new e.mwg.ml.common.matrix.HybridMatrixEngine);return a._defaultEngine};a.setDefaultEngine=function(c){a._defaultEngine=c};a.multiply=function(a,b){return e.mwg.ml.common.matrix.Matrix.defaultEngine().multiplyTransposeAlphaBeta(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE,1,a,e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE,b,0,null)};a.multiplyTranspose=function(a,b,d,m){return e.mwg.ml.common.matrix.Matrix.defaultEngine().multiplyTransposeAlphaBeta(a,1,b,d,m,0,null)};a.multiplyTransposeAlpha=
function(a,b,d,m,f){return e.mwg.ml.common.matrix.Matrix.defaultEngine().multiplyTransposeAlphaBeta(a,b,d,m,f,0,null)};a.multiplyTransposeAlphaBeta=function(a,b,d,m,f,q,p){return e.mwg.ml.common.matrix.Matrix.defaultEngine().multiplyTransposeAlphaBeta(a,b,d,m,f,q,p)};a.invert=function(a,b){return e.mwg.ml.common.matrix.Matrix.defaultEngine().invert(a,b)};a.pinv=function(a,b){return e.mwg.ml.common.matrix.Matrix.defaultEngine().pinv(a,b)};a.prototype.leadingDimension=function(){return Math.max(this._nbColumns,
this._nbRows)};a.random=function(a,b,d,m){for(var f=new e.mwg.ml.common.matrix.Matrix(null,a,b),q=new java.util.Random,p=0;p<a*b;p++)f.setAtIndex(p,q.nextDouble()*(m-d)+d);return f};a.scale=function(a,b){if(0==a)b.setAll(0);else for(var d=0;d<b.rows()*b.columns();d++)b.setAtIndex(d,a*b.getAtIndex(d))};a.transpose=function(a){var b=new e.mwg.ml.common.matrix.Matrix(null,a.columns(),a.rows());a.columns()==a.rows()?e.mwg.ml.common.matrix.Matrix.transposeSquare(a,b):375<a.columns()&&375<a.rows()?e.mwg.ml.common.matrix.Matrix.transposeBlock(a,
b):e.mwg.ml.common.matrix.Matrix.transposeStandard(a,b);return b};a.transposeSquare=function(a,b){for(var d=1,m=a.columns(),f=0;f<a.rows();f++){var e=(f+1)*a.columns()+f,p=f*(a.columns()+1);for(b.setAtIndex(p,a.getAtIndex(p));d<m;d++)b.setAtIndex(d,a.getAtIndex(e)),b.setAtIndex(e,a.getAtIndex(d)),e+=a.columns();d+=f+2;m+=a.columns()}};a.transposeStandard=function(a,b){for(var d=0,m=0;m<b.columns();m++)for(var f=m,e=d+b.rows();d<e;)b.setAtIndex(d++,a.getAtIndex(f)),f+=a.rows()};a.transposeBlock=function(a,
b){for(var d=0;d<a.columns();d+=60)for(var m=Math.min(60,a.columns()-d),f=d*a.rows(),e=d,p=0;p<a.rows();p+=60)for(var l=Math.min(60,a.rows()-p),l=f+l;f<l;f++){for(var h=f,k=e,g=k+m;k<g;k++)b.setAtIndex(k,a.getAtIndex(h)),h+=a.rows();e+=b.rows()}};a.prototype.saveToState=function(){var a=new Float64Array(this._data.length+2);a[0]=this._nbRows;a[1]=this._nbColumns;java.lang.System.arraycopy(this._data,0,a,2,this._data.length);return a};a.loadFromState=function(a){var b=new Float64Array(a.length-2);
java.lang.System.arraycopy(a,2,b,0,b.length);return new e.mwg.ml.common.matrix.Matrix(b,a[0],a[1])};a.createIdentity=function(a,b){for(var d=new e.mwg.ml.common.matrix.Matrix(null,a,b),m=Math.min(a,b),f=0;f<m;f++)d.set(f,f,1);return d};a.compareMatrix=function(a,b){for(var d=0,m=0;m<a.rows();m++)for(var f=0;f<a.columns();f++)d<Math.abs(a.get(m,f)-b.get(m,f))&&(d=Math.abs(a.get(m,f)-b.get(m,f)));return d};a.testDimensionsAB=function(a,b,d,m){return a.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?
b.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?d.columns()==m.rows():d.columns()==m.columns():b.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?d.rows()==m.rows():d.rows()==m.columns()};a.identity=function(a,b){for(var d=new e.mwg.ml.common.matrix.Matrix(null,a,b),m=0;m<Math.max(a,b);m++)d.set(m,m,1);return d};a._defaultEngine=null;return a}();n.Matrix=g;g=function(){function a(){}a.prototype.equals=function(a){return this==a};a.values=function(){return a._TransposeTypeVALUES};
a.NOTRANSPOSE=new a;a.TRANSPOSE=new a;a._TransposeTypeVALUES=[a.NOTRANSPOSE,a.TRANSPOSE];return a}();n.TransposeType=g;(function(a){var c=function(){function a(){this._blas=new e.mwg.ml.common.matrix.blassolver.blas.JSBlas}a.prototype.setBlas=function(a){this._blas=a};a.prototype.getBlas=function(){return this._blas};a.prototype.multiplyTransposeAlphaBeta=function(a,b,f,c,p,l,h){if(e.mwg.ml.common.matrix.Matrix.testDimensionsAB(a,c,f,p)){var k,g=new Int32Array(2);a.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?
(k=f.columns(),c.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?(g[0]=f.rows(),g[1]=p.columns()):(g[0]=f.rows(),g[1]=p.rows())):(k=f.rows(),c.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?(g[0]=f.columns(),g[1]=p.columns()):(g[0]=f.columns(),g[1]=p.rows()));if(0==l||null==h)h=new e.mwg.ml.common.matrix.Matrix(null,g[0],g[1]);this._blas.dgemm(a,c,h.rows(),h.columns(),k,b,f.data(),0,f.rows(),p.data(),0,p.rows(),l,h.data(),0,h.rows());return h}throw Error("Dimensions mismatch between A,B and C");
};a.prototype.invert=function(a,b){if(a.rows()!=a.columns())return null;if(b){var f=new e.mwg.ml.common.matrix.blassolver.LU(a.rows(),a.columns(),this._blas);return f.invert(a)?a:null}var c=new e.mwg.ml.common.matrix.Matrix(null,a.rows(),a.columns()),g=new e.mwg.ml.common.matrix.Matrix(null,a.rows(),a.columns());java.lang.System.arraycopy(a.data(),0,g.data(),0,a.columns()*a.rows());f=new e.mwg.ml.common.matrix.blassolver.LU(g.rows(),g.columns(),this._blas);return f.invert(g)?(c.setData(g.data()),
c):null};a.prototype.pinv=function(a,b){return this.solve(a,e.mwg.ml.common.matrix.Matrix.identity(a.rows(),a.rows()))};a.prototype.solveQR=function(a,b,f,c){f=e.mwg.ml.common.matrix.blassolver.QR.factorize(a,f,this._blas);a=new e.mwg.ml.common.matrix.Matrix(null,a.columns(),b.columns());c!=e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE&&(b=e.mwg.ml.common.matrix.Matrix.transpose(b));f.solve(b,a);return a};a.prototype.decomposeSVD=function(a,b){var f=new e.mwg.ml.common.matrix.blassolver.SVD(a.rows(),
a.columns(),this._blas);f.factor(a,b);return f};a.prototype.solveLU=function(a,b,f,c){if(f){f=new e.mwg.ml.common.matrix.blassolver.LU(a.rows(),a.columns(),this._blas);f.factor(a,!0);if(f.isSingular())return null;f.transSolve(b,c);return b}var g=new e.mwg.ml.common.matrix.Matrix(null,a.rows(),a.columns());java.lang.System.arraycopy(a.data(),0,g.data(),0,a.columns()*a.rows());f=new e.mwg.ml.common.matrix.blassolver.LU(g.rows(),g.columns(),this._blas);f.factor(g,!0);if(f.isSingular())return null;a=
new e.mwg.ml.common.matrix.Matrix(null,b.rows(),b.columns());java.lang.System.arraycopy(b.data(),0,a.data(),0,b.columns()*b.rows());f.transSolve(a,c);return a};a.prototype.solve=function(a,b){return a.rows()==a.columns()?(new e.mwg.ml.common.matrix.blassolver.LU(a.rows(),a.columns(),this._blas)).factor(a,!1).solve(b):this.solveQR(a,b,!1,e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)};return a}();a.BlasMatrixEngine=c;c=function(){function a(){}a.prototype.netlib=function(){switch(this){case a.All:return"A";
case a.Part:return"S";case a.Overwrite:return"O";default:return"N"}};a.prototype.equals=function(a){return this==a};a.values=function(){return a._JobSVDVALUES};a.All=new a;a.None=new a;a.Overwrite=new a;a.Part=new a;a._JobSVDVALUES=[a.All,a.None,a.Overwrite,a.Part];return a}();a.JobSVD=c;c=function(){function a(d,b,f){this._blas=f;this.LU=new e.mwg.ml.common.matrix.Matrix(null,d,b);this.piv=new Int32Array(Math.min(d,b))}a.prototype.getLU=function(){return this.LU};a.factorize=function(a,b){return(new e.mwg.ml.common.matrix.blassolver.LU(a.rows(),
a.columns(),b)).factor(a,!1)};a.prototype.factor=function(a,b){if(b){this.singular=!1;var f=new Int32Array(1);f[0]=0;this._blas.dgetrf(a.rows(),a.columns(),a.data(),0,a.rows(),this.piv,0,f);if(0<f[0])this.singular=!0;else if(0>f[0])throw Error();this.LU.setData(a.data())}else{this.singular=!1;var c=a.clone(),f=new Int32Array(1);f[0]=0;this._blas.dgetrf(c.rows(),c.columns(),c.data(),0,c.rows(),this.piv,0,f);if(0<f[0])this.singular=!0;else if(0>f[0])throw Error();this.LU.setData(c.data())}return this};
a.prototype.getL=function(){for(var a=this.LU.rows(),b=this.LU.rows()<this.LU.columns()?this.LU.rows():this.LU.columns(),f=new e.mwg.ml.common.matrix.Matrix(null,a,b),c=0;c<b;c++){f.set(c,c,1);for(var g=0;g<c;g++)f.set(c,g,this.LU.get(c,g))}if(a>b)for(c=b;c<a;c++)for(g=0;g<b;g++)f.set(c,g,this.LU.get(c,g));return f};a.prototype.getU=function(){for(var a=this.LU.rows()<this.LU.columns()?this.LU.rows():this.LU.columns(),b=this.LU.columns(),f=new e.mwg.ml.common.matrix.Matrix(null,a,b),c=0;c<a;c++)for(var g=
c;g<b;g++)f.set(c,g,this.LU.get(c,g));return f};a.prototype.getPivots=function(){return this.piv};a.prototype.isSingular=function(){return this.singular};a.prototype.solve=function(a){return this.transSolve(a,e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)};a.prototype.transSolve=function(a,b){if(a.rows()!=this.LU.rows())throw Error("B.numRows() != LU.numRows()");var f=new Int32Array(1);this._blas.dgetrs(b,this.LU.rows(),a.columns(),this.LU.data(),0,this.LU.rows(),this.piv,0,a.data(),0,a.rows(),
f);if(0>f[0])throw Error();return a};a.prototype.invert=function(a){var b=new Int32Array(1);b[0]=0;this._blas.dgetrf(a.rows(),a.columns(),a.data(),0,a.rows(),this.piv,0,b);if(0<b[0])return this.singular=!0,!1;if(0>b[0])throw Error();for(var f=a.rows()*a.rows(),c=new Float64Array(f),e=0;e<f;e++)c[e]=0;this._blas.dgetri(a.rows(),a.data(),0,a.rows(),this.piv,0,c,0,f,b);return 0!=b[0]?!1:!0};return a}();a.LU=c;c=function(){function a(d,b,f){this._blas=f;if(b>d)throw Error("n > m");this.m=d;this.n=b;this.k=
Math.min(this.m,this.n);this.tau=new Float64Array(this.k);this.R=new e.mwg.ml.common.matrix.Matrix(null,this.n,this.n)}a.factorize=function(a,b,f){return(new e.mwg.ml.common.matrix.blassolver.QR(a.rows(),a.columns(),f)).factor(a,b)};a.prototype.factor=function(a,b){var f;f=b?a:a.clone();var c;this.work=new Float64Array(1);var e=new Int32Array(1);e[0]=0;this._blas.dgeqrf(this.m,this.n,new Float64Array(0),0,this.m,new Float64Array(0),0,this.work,0,-1,e);c=0!=e[0]?this.n:this.work[0];c=Math.max(1,c);
this.work=new Float64Array(c);this.workGen=new Float64Array(1);e[0]=0;this._blas.dorgqr(this.m,this.n,this.k,new Float64Array(0),0,this.m,new Float64Array(0),0,this.workGen,0,-1,e);c=0!=e[0]?this.n:this.workGen[0];c=Math.max(1,c);this.workGen=new Float64Array(c);e[0]=0;this._blas.dgeqrf(this.m,this.n,f.data(),0,this.m,this.tau,0,this.work,0,this.work.length,e);if(0>e[0])throw Error(""+e[0]);for(c=0;c<f.columns();c++)for(var l=0;l<=c;l++)this.R.set(l,c,f.get(l,c));e[0]=0;this._blas.dorgqr(this.m,this.n,
this.k,f.data(),0,this.m,this.tau,0,this.workGen,0,this.workGen.length,e);if(0>e[0])throw Error();this.Q=f;return this};a.prototype.solve=function(a,b){for(var f=a.columns(),c=new e.mwg.ml.common.matrix.Matrix(null,this.m,1),g,l=0;l<f;l++){for(var h=0;h<this.m;h++)c.setAtIndex(h,a.get(h,l));g=e.mwg.ml.common.matrix.Matrix.multiplyTranspose(e.mwg.ml.common.matrix.TransposeType.TRANSPOSE,this.Q,e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE,c);this.solveU(this.R,g.data(),this.n,this.m);for(h=0;h<
this.n;h++)b.set(h,l,g.getAtIndex(h))}};a.prototype.solveU=function(a,b,f,c){for(c=f-1;0<=c;c--){for(var e=b[c],l=c+1;l<f;l++)e-=a.get(c,l)*b[l];b[c]=e/a.get(c,c)}};a.prototype.getR=function(){return this.R};a.prototype.getQ=function(){return this.Q};return a}();a.QR=c;c=function(){function a(d,b,f){this.m=d;this.n=b;this._blas=f;this.vectors=!0;this.S=new Float64Array(Math.min(d,b));this.vectors?(this.U=new e.mwg.ml.common.matrix.Matrix(null,d,d),this.Vt=new e.mwg.ml.common.matrix.Matrix(null,b,
b)):this.U=this.Vt=null;this.job=this.vectors?e.mwg.ml.common.matrix.blassolver.JobSVD.All:e.mwg.ml.common.matrix.blassolver.JobSVD.None;this.iwork=new Int32Array(8*Math.min(d,b));f=new Float64Array(1);var c=new Int32Array(1);this._blas.dgesdd(this.job.netlib(),d,b,new Float64Array(0),Math.max(1,d),new Float64Array(0),new Float64Array(0),Math.max(1,d),new Float64Array(0),Math.max(1,b),f,-1,this.iwork,c);d=0!=c[0]?this.vectors?3*Math.min(d,b)*Math.min(d,b)+Math.max(Math.max(d,b),4*Math.min(d,b)*Math.min(d,
b)+4*Math.min(d,b)):3*Math.min(d,b)*Math.min(d,b)+Math.max(Math.max(d,b),5*Math.min(d,b)*Math.min(d,b)+4*Math.min(d,b)):f[0];d=Math.max(d,1);this.work=new Float64Array(d)}a.prototype.factor=function(a,b){if(a.rows()!=this.m)throw Error("A.numRows() != m");if(a.columns()!=this.n)throw Error("A.numColumns() != n");var f=new Int32Array(1);f[0]=0;if(b)this._blas.dgesdd(this.job.netlib(),this.m,this.n,a.data(),Math.max(1,this.m),this.S,this.vectors?this.U.data():new Float64Array(0),Math.max(1,this.m),
this.vectors?this.Vt.data():new Float64Array(0),Math.max(1,this.n),this.work,this.work.length,this.iwork,f);else{var c=a.data(),e=new Float64Array(c.length);java.lang.System.arraycopy(c,0,e,0,c.length);this._blas.dgesdd(this.job.netlib(),this.m,this.n,e,Math.max(1,this.m),this.S,this.vectors?this.U.data():new Float64Array(0),Math.max(1,this.m),this.vectors?this.Vt.data():new Float64Array(0),Math.max(1,this.n),this.work,this.work.length,this.iwork,f)}if(0<f[0])throw Error("NotConvergedException.Reason.Iterations");
if(0>f[0])throw Error();return this};a.prototype.hasSingularVectors=function(){return null!=this.U};a.prototype.getU=function(){return this.U};a.prototype.getVt=function(){return this.Vt};a.prototype.getS=function(){return this.S};a.prototype.getSMatrix=function(){for(var a=new e.mwg.ml.common.matrix.Matrix(null,this.m,this.n),b=0;b<this.S.length;b++)a.set(b,b,this.S[b]);return a};return a}();a.SVD=c;(function(a){var d=function(){function a(){}a.transTypeToChar=function(d){return d.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?
a.TRANSPOSE_TYPE_NOTRANSPOSE:d.equals(e.mwg.ml.common.matrix.TransposeType.TRANSPOSE)?a.TRANSPOSE_TYPE_TRANSPOSE:null};a.TRANSPOSE_TYPE_CONJUCATE="c";a.TRANSPOSE_TYPE_NOTRANSPOSE="n";a.TRANSPOSE_TYPE_TRANSPOSE="t";return a}();a.BlasHelper=d})(a.blas||(a.blas={}))})(n.blassolver||(n.blassolver={}));(function(a){var c=function(){function a(){}a.prototype.multiplyTransposeAlphaBeta=function(a,b,f,c,g,l,h){if(e.mwg.ml.common.matrix.Matrix.testDimensionsAB(a,c,f,g)){var k=new Int32Array(3);a.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?
(c.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?(k[0]=f.rows(),k[1]=g.columns()):(k[0]=f.rows(),k[1]=g.rows()),k[2]=f.columns()):(c.equals(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)?(k[0]=f.columns(),k[1]=g.columns()):(k[0]=f.columns(),k[1]=g.rows()),k[2]=f.rows());if(0==l||null==h)h=new e.mwg.ml.common.matrix.Matrix(null,k[0],k[1]);if(a==e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE&&c==e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)for(c=0;c<k[0];c++)for(var v=0;v<k[1];v++){for(var n=
a=0;n<k[2];n++)a+=b*f.get(c,n)*g.get(n,v);0!=l&&(a+=l*h.get(c,v));h.set(c,v,a)}else if(a==e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE&&c==e.mwg.ml.common.matrix.TransposeType.TRANSPOSE)for(c=0;c<k[0];c++)for(v=0;v<k[1];v++){for(n=a=0;n<k[2];n++)a+=b*f.get(c,n)*g.get(v,n);0!=l&&(a+=l*h.get(c,v));h.set(c,v,a)}else if(a==e.mwg.ml.common.matrix.TransposeType.TRANSPOSE&&c==e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)for(c=0;c<k[0];c++)for(v=0;v<k[1];v++){for(n=a=0;n<k[2];n++)a+=b*f.get(n,c)*
g.get(n,v);0!=l&&(a+=l*h.get(c,v));h.set(c,v,a)}else if(a==e.mwg.ml.common.matrix.TransposeType.TRANSPOSE&&c==e.mwg.ml.common.matrix.TransposeType.TRANSPOSE)for(c=0;c<k[0];c++)for(v=0;v<k[1];v++){for(n=a=0;n<k[2];n++)a+=b*f.get(n,c)*g.get(v,n);0!=l&&(a+=l*h.get(c,v));h.set(c,v,a)}return h}throw Error("Dimensions mismatch between A,B and C");};a.prototype.invert=function(a,b){return e.mwg.ml.common.matrix.jamasolver.JamaMatrixEngine.solve(a,e.mwg.ml.common.matrix.Matrix.identity(a.rows(),a.rows()))};
a.prototype.pinv=function(a,b){return e.mwg.ml.common.matrix.jamasolver.JamaMatrixEngine.solve(a,e.mwg.ml.common.matrix.Matrix.identity(a.rows(),a.rows()))};a.prototype.solveLU=function(a,b,f,c){b=c==e.mwg.ml.common.matrix.TransposeType.TRANSPOSE?e.mwg.ml.common.matrix.Matrix.transpose(b):b;return(new e.mwg.ml.common.matrix.jamasolver.LU(a)).solve(b)};a.prototype.solveQR=function(a,b,f,c){b=c==e.mwg.ml.common.matrix.TransposeType.TRANSPOSE?e.mwg.ml.common.matrix.Matrix.transpose(b):b;return(new e.mwg.ml.common.matrix.jamasolver.QR(a)).solve(b)};
a.prototype.decomposeSVD=function(a,b){return new e.mwg.ml.common.matrix.jamasolver.SVD(a)};a.solve=function(a,b){return a.rows()==a.columns()?(new e.mwg.ml.common.matrix.jamasolver.LU(a)).solve(b):(new e.mwg.ml.common.matrix.jamasolver.QR(a)).solve(b)};return a}();a.JamaMatrixEngine=c;c=function(){function a(d){this.LU=d.clone();this.m=d.rows();this.n=d.columns();this.piv=new Int32Array(this.m);for(var b=0;b<this.m;b++)this.piv[b]=b;this.pivsign=1;d=new Float64Array(this.m);for(var f=0;f<this.n;f++){for(b=
0;b<this.m;b++)d[b]=this.LU.get(b,f);for(b=0;b<this.m;b++){for(var c=Math.min(b,f),e=0,l=0;l<c;l++)e+=this.LU.get(b,l)*d[l];d[b]-=e;this.LU.set(b,f,d[b])}c=f;for(b=f+1;b<this.m;b++)Math.abs(d[b])>Math.abs(d[c])&&(c=b);if(c!=f){for(b=0;b<this.n;b++)l=this.LU.get(c,b),this.LU.set(c,b,this.LU.get(f,b)),this.LU.set(f,b,l);l=this.piv[c];this.piv[c]=this.piv[f];this.piv[f]=l;this.pivsign=-this.pivsign}if(f<this.m&&0!=this.LU.get(f,f))for(b=f+1;b<this.m;b++)this.LU.set(b,f,this.LU.get(b,f)/this.LU.get(f,
f))}}a.prototype.isNonsingular=function(){for(var a=0;a<this.n;a++)if(0==this.LU.get(a,a))return!1;return!0};a.prototype.getL=function(){for(var a=new e.mwg.ml.common.matrix.Matrix(null,this.m,this.n),b=0;b<this.m;b++)for(var f=0;f<this.n;f++)b>f?a.set(b,f,this.LU.get(b,f)):b==f?a.set(b,f,1):a.set(b,f,0);return a};a.prototype.getU=function(){for(var a=new e.mwg.ml.common.matrix.Matrix(null,this.n,this.n),b=0;b<this.n;b++)for(var f=0;f<this.n;f++)b<=f?a.set(b,f,this.LU.get(b,f)):a.set(b,f,0);return a};
a.prototype.getPivot=function(){for(var a=new Int32Array(this.m),b=0;b<this.m;b++)a[b]=this.piv[b];return a};a.prototype.getDoublePivot=function(){for(var a=new Float64Array(this.m),b=0;b<this.m;b++)a[b]=this.piv[b];return a};a.prototype.det=function(){if(this.m!=this.n)throw Error("Matrix must be square.");for(var a=this.pivsign,b=0;b<this.n;b++)a*=this.LU.get(b,b);return a};a.prototype.solve=function(a){if(a.rows()!=this.m)throw Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw Error("Matrix is singular.");
var b=a.columns();a=this.getMatrix(a,this.piv,0,b-1);for(var f=0;f<this.n;f++)for(var c=f+1;c<this.n;c++)for(var e=0;e<b;e++)a.add(c,e,-a.get(f,e)*this.LU.get(c,f));for(f=this.n-1;0<=f;f--){for(e=0;e<b;e++)a.set(f,e,a.get(f,e)/this.LU.get(f,f));for(c=0;c<f;c++)for(e=0;e<b;e++)a.add(c,e,-a.get(f,e)*this.LU.get(c,f))}return a};a.prototype.getMatrix=function(a,b,c,g){var p=new e.mwg.ml.common.matrix.Matrix(null,b.length,g-c+1);try{for(var l=0;l<b.length;l++)for(var h=c;h<=g;h++)p.set(l,h-c,a.get(b[l],
h))}catch(k){if(k instanceof Error)throw Error("Submatrix indices");throw k;}return p};return a}();a.LU=c;c=function(){function a(b){this.QR=b.clone();this.m=b.rows();this.n=b.columns();this.Rdiag=new Float64Array(this.n);for(b=0;b<this.n;b++){for(var c=0,f=b;f<this.m;f++)c=e.mwg.ml.common.matrix.jamasolver.Utils.hypot(c,this.QR.get(f,b));if(0!=c){0>this.QR.get(b,b)&&(c=-c);for(f=b;f<this.m;f++)this.QR.set(f,b,this.QR.get(f,b)/c);this.QR.add(b,b,1);for(var g=b+1;g<this.n;g++){for(var p=0,f=b;f<this.m;f++)p+=
this.QR.get(f,b)*this.QR.get(f,g);p=-p/this.QR.get(b,b);for(f=b;f<this.m;f++)this.QR.add(f,g,p*this.QR.get(f,b))}}this.Rdiag[b]=-c}}a.prototype.isFullRank=function(){for(var a=0;a<this.n;a++)if(0==this.Rdiag[a])return!1;return!0};a.prototype.getH=function(){for(var a=new e.mwg.ml.common.matrix.Matrix(null,this.m,this.n),b=0;b<this.m;b++)for(var c=0;c<this.n;c++)b>=c?a.set(b,c,this.QR.get(b,c)):a.set(b,c,0);return a};a.prototype.getR=function(){for(var a=new e.mwg.ml.common.matrix.Matrix(null,this.n,
this.n),b=0;b<this.n;b++)for(var c=0;c<this.n;c++)b<c?a.set(b,c,this.QR.get(b,c)):b==c?a.set(b,c,this.Rdiag[b]):a.set(b,c,0);return a};a.prototype.getQ=function(){for(var a=new e.mwg.ml.common.matrix.Matrix(null,this.m,this.n),b=this.n-1;0<=b;b--){for(var c=0;c<this.m;c++)a.set(c,b,0);a.set(b,b,1);for(var g=b;g<this.n;g++)if(0!=this.QR.get(b,b)){for(var p=0,c=b;c<this.m;c++)p+=this.QR.get(c,b)*a.get(c,g);p=-p/this.QR.get(b,b);for(c=b;c<this.m;c++)a.add(c,g,p*this.QR.get(c,b))}}return a};a.prototype.solve=
function(a){if(a.rows()!=this.m)throw Error("Matrix row dimensions must agree.");if(!this.isFullRank())throw Error("Matrix is rank deficient.");var b=a.columns();a=a.clone();for(var c=0;c<this.n;c++)for(var g=0;g<b;g++){for(var p=0,l=c;l<this.m;l++)p+=this.QR.get(l,c)*a.get(l,g);p=-p/this.QR.get(c,c);for(l=c;l<this.m;l++)a.add(l,g,p*this.QR.get(l,c))}for(c=this.n-1;0<=c;c--){for(g=0;g<b;g++)a.set(c,g,a.get(c,g)/this.Rdiag[c]);for(l=0;l<c;l++)for(g=0;g<b;g++)a.add(l,g,-a.get(c,g)*this.QR.get(l,c))}return e.mwg.ml.common.matrix.jamasolver.QR.getMatrix(a,
0,this.n-1,0,b-1)};a.getMatrix=function(a,b,c,g,p){var l=new e.mwg.ml.common.matrix.Matrix(null,c-b+1,p-g+1);try{for(var h=b;h<=c;h++)for(var k=g;k<=p;k++)l.set(h-b,k-g,a.get(h,k))}catch(n){if(n instanceof Error)throw Error("Submatrix indices");throw n;}return l};return a}();a.QR=c;c=function(){function a(b){var c=b.clone();this.m=b.rows();this.n=b.columns();var f=Math.min(this.m,this.n);this.s=new Float64Array(Math.min(this.m+1,this.n));this.U=new e.mwg.ml.common.matrix.Matrix(null,this.m,f);this.V=
new e.mwg.ml.common.matrix.Matrix(null,this.n,this.n);b=new Float64Array(this.n);for(var g=new Float64Array(this.m),p=Math.min(this.m-1,this.n),l=Math.max(0,Math.min(this.n-2,this.m)),h=0;h<Math.max(p,l);h++){if(h<p){this.s[h]=0;for(var k=h;k<this.m;k++)this.s[h]=e.mwg.ml.common.matrix.jamasolver.Utils.hypot(this.s[h],c.get(k,h));if(0!=this.s[h]){0>c.get(h,h)&&(this.s[h]=-this.s[h]);for(k=h;k<this.m;k++)c.set(k,h,c.get(k,h)/this.s[h]);c.add(h,h,1)}this.s[h]=-this.s[h]}for(var n=h+1;n<this.n;n++){if(h<
p&&0!=this.s[h]){for(var r=0,k=h;k<this.m;k++)r+=c.get(k,h)*c.get(k,n);r=-r/c.get(h,h);for(k=h;k<this.m;k++)c.add(k,n,+r*c.get(k,h))}b[n]=c.get(h,n)}if(h<p)for(k=h;k<this.m;k++)this.U.set(k,h,c.get(k,h));if(h<l){b[h]=0;for(k=h+1;k<this.n;k++)b[h]=e.mwg.ml.common.matrix.jamasolver.Utils.hypot(b[h],b[k]);if(0!=b[h]){0>b[h+1]&&(b[h]=-b[h]);for(k=h+1;k<this.n;k++)b[k]/=b[h];b[h+1]+=1}b[h]=-b[h];if(h+1<this.m&&0!=b[h]){for(k=h+1;k<this.m;k++)g[k]=0;for(n=h+1;n<this.n;n++)for(k=h+1;k<this.m;k++)g[k]+=b[n]*
c.get(k,n);for(n=h+1;n<this.n;n++)for(r=-b[n]/b[h+1],k=h+1;k<this.m;k++)c.add(k,n,r*g[k])}for(k=h+1;k<this.n;k++)this.V.set(k,h,b[k])}}g=Math.min(this.n,this.m+1);p<this.n&&(this.s[p]=c.get(p,p));this.m<g&&(this.s[g-1]=0);l+1<g&&(b[l]=c.get(l,g-1));b[g-1]=0;for(n=p;n<f;n++){for(k=0;k<this.m;k++)this.U.set(k,n,0);this.U.set(n,n,1)}for(h=p-1;0<=h;h--)if(0!=this.s[h]){for(n=h+1;n<f;n++){r=0;for(k=h;k<this.m;k++)r+=this.U.get(k,h)*this.U.get(k,n);r=-r/this.U.get(h,h);for(k=h;k<this.m;k++)this.U.add(k,
n,r*this.U.get(k,h))}for(k=h;k<this.m;k++)this.U.set(k,h,-this.U.get(k,h));this.U.set(h,h,1+this.U.get(h,h));for(k=0;k<h-1;k++)this.U.set(k,h,0)}else{for(k=0;k<this.m;k++)this.U.set(k,h,0);this.U.set(h,h,1)}for(h=this.n-1;0<=h;h--){if(h<l&&0!=b[h])for(n=h+1;n<f;n++){r=0;for(k=h+1;k<this.n;k++)r+=this.V.get(k,h)*this.V.get(k,n);r=-r/this.V.get(h+1,h);for(k=h+1;k<this.n;k++)this.V.add(k,n,r*this.V.get(k,h))}for(k=0;k<this.n;k++)this.V.set(k,h,0);this.V.set(h,h,1)}c=g-1;f=Math.pow(2,-52);for(p=Math.pow(2,
-966);0<g;){for(h=g-2;-1<=h&&-1!=h;h--)if(Math.abs(b[h])<=p+f*(Math.abs(this.s[h])+Math.abs(this.s[h+1]))){b[h]=0;break}if(h==g-2)r=4;else{for(k=g-1;k>=h&&k!=h;k--)if(r=(k!=g?Math.abs(b[k]):0)+(k!=h+1?Math.abs(b[k-1]):0),Math.abs(this.s[k])<=p+f*r){this.s[k]=0;break}k==h?r=3:k==g-1?r=1:(r=2,h=k)}h++;switch(r){case 1:l=b[g-2];b[g-2]=0;for(n=g-2;n>=h;n--){var r=e.mwg.ml.common.matrix.jamasolver.Utils.hypot(this.s[n],l),t=this.s[n]/r,u=l/r;this.s[n]=r;n!=h&&(l=-u*b[n-1],b[n-1]*=t);for(k=0;k<this.n;k++)r=
t*this.V.get(k,n)+u*this.V.get(k,g-1),this.V.set(k,g-1,-u*this.V.get(k,n)+t*this.V.get(k,g-1)),this.V.set(k,n,r)}break;case 2:l=b[h-1];b[h-1]=0;for(n=h;n<g;n++)for(r=e.mwg.ml.common.matrix.jamasolver.Utils.hypot(this.s[n],l),t=this.s[n]/r,u=l/r,this.s[n]=r,l=-u*b[n],b[n]*=t,k=0;k<this.m;k++)r=t*this.U.get(k,n)+u*this.U.get(k,h-1),this.U.set(k,h-1,-u*this.U.get(k,n)+t*this.U.get(k,h-1)),this.U.set(k,n,r);break;case 3:n=Math.max(Math.max(Math.max(Math.max(Math.abs(this.s[g-1]),Math.abs(this.s[g-2])),
Math.abs(b[g-2])),Math.abs(this.s[h])),Math.abs(b[h]));k=this.s[g-1]/n;t=this.s[g-2]/n;l=b[g-2]/n;r=this.s[h]/n;n=b[h]/n;t=((t+k)*(t-k)+l*l)/2;l*=k*l*k;u=0;if(0!=t||0!=l)u=Math.sqrt(t*t+l),0>t&&(u=-u),u=l/(t+u);for(var l=(r+k)*(r-k)+u,y=r*n,n=h;n<g-1;n++){r=e.mwg.ml.common.matrix.jamasolver.Utils.hypot(l,y);t=l/r;u=y/r;n!=h&&(b[n-1]=r);l=t*this.s[n]+u*b[n];b[n]=t*b[n]-u*this.s[n];y=u*this.s[n+1];this.s[n+1]*=t;for(k=0;k<this.n;k++)r=t*this.V.get(k,n)+u*this.V.get(k,n+1),this.V.set(k,n+1,-u*this.V.get(k,
n)+t*this.V.get(k,n+1)),this.V.set(k,n,r);r=e.mwg.ml.common.matrix.jamasolver.Utils.hypot(l,y);t=l/r;u=y/r;this.s[n]=r;l=t*b[n]+u*this.s[n+1];this.s[n+1]=-u*b[n]+t*this.s[n+1];y=u*b[n+1];b[n+1]*=t;if(n<this.m-1)for(k=0;k<this.m;k++)r=t*this.U.get(k,n)+u*this.U.get(k,n+1),this.U.set(k,n+1,-u*this.U.get(k,n)+t*this.U.get(k,n+1)),this.U.set(k,n,r)}b[g-2]=l;break;case 4:if(0>=this.s[h])for(this.s[h]=0>this.s[h]?-this.s[h]:0,k=0;k<=c;k++)this.V.set(k,h,-this.V.get(k,h));for(;h<c&&!(this.s[h]>=this.s[h+
1]);){r=this.s[h];this.s[h]=this.s[h+1];this.s[h+1]=r;if(h<this.n-1)for(k=0;k<this.n;k++)r=this.V.get(k,h+1),this.V.set(k,h+1,this.V.get(k,h)),this.V.set(k,h,r);if(h<this.m-1)for(k=0;k<this.m;k++)r=this.U.get(k,h+1),this.U.set(k,h+1,this.U.get(k,h)),this.U.set(k,h,r);h++}g--}}}a.prototype.factor=function(a,b){return new e.mwg.ml.common.matrix.jamasolver.SVD(a)};a.prototype.getU=function(){return this.U};a.prototype.getVt=function(){return e.mwg.ml.common.matrix.Matrix.transpose(this.getV())};a.prototype.getV=
function(){return this.V};a.prototype.getSingularValues=function(){return this.s};a.prototype.getSMatrix=function(){for(var a=new e.mwg.ml.common.matrix.Matrix(null,Math.min(this.m,this.n),this.n),b=0;b<this.s.length;b++)b<this.m&&b<this.n&&a.set(b,b,this.s[b]);return a};a.prototype.getS=function(){return this.s};a.prototype.norm2=function(){return this.s[0]};a.prototype.cond=function(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]};a.prototype.rank=function(){for(var a=Math.max(this.m,this.n)*
this.s[0]*Math.pow(2,-52),b=0,c=0;c<this.s.length;c++)this.s[c]>a&&b++;return b};a.serialVersionUID=1;return a}();a.SVD=c;c=function(){function a(){}a.hypot=function(a,b){var c;Math.abs(a)>Math.abs(b)?(c=b/a,c=Math.abs(a)*Math.sqrt(1+c*c)):0!=b?(c=a/b,c=Math.abs(b)*Math.sqrt(1+c*c)):c=0;return c};return a}();a.Utils=c})(n.jamasolver||(n.jamasolver={}));(function(a){var c=function(){function a(){}a.getCovariance=function(a,b,c){return(b-a*a/c)/(c-1)};a.getDensity=function(a,b,c,g){if(2>c)return 0;
var n=a/c;a=e.mwg.ml.common.matrix.operation.Gaussian1D.getCovariance(a,b,c);return 1/Math.sqrt(2*Math.PI*a)*Math.exp(-(g-n)*(g-n)/(2*a))};a.getDensityArray=function(a,b,c,g){if(2>c)return null;var n=a/c;a=e.mwg.ml.common.matrix.operation.Gaussian1D.getCovariance(a,b,c);b=1/Math.sqrt(2*Math.PI*a);c=new Float64Array(g.length);for(var l=0;l<g.length;l++)c[l]=b*Math.exp(-(g[l]-n)*(g[l]-n)/(2*a));return c};return a}();a.Gaussian1D=c;c=function(){function a(b,c,f){this.means=b;if(null!=c){this.covariance=
c;this.covDiag=new Float64Array(c.rows());for(b=0;b<this.covDiag.length;b++)this.covDiag[b]=c.get(b,b);this.pinvsvd=new e.mwg.ml.common.matrix.operation.PInvSVD;this.pinvsvd.factor(this.covariance,!1);this.inv=this.pinvsvd.getPInv();this.det=this.pinvsvd.getDeterminant();this.rank=this.pinvsvd.getRank();if(!f&&this.rank<c.rows()){this.covariance=c.clone();c=new Float64Array(this.covDiag.length);for(b=0;b<this.covDiag.length;b++)c[b]=Math.sqrt(this.covDiag[b]);for(b=0;b<this.covDiag.length;b++)for(f=
b+1;f<this.covDiag.length;f++){var g=this.covariance.get(b,f)-1E-4*c[b]*c[f];this.covariance.set(b,f,g);this.covariance.set(f,b,g)}this.pinvsvd=new e.mwg.ml.common.matrix.operation.PInvSVD;this.pinvsvd.factor(this.covariance,!1);this.inv=this.pinvsvd.getPInv();this.det=this.pinvsvd.getDeterminant();this.rank=this.pinvsvd.getRank()}}}a.prototype.getMin=function(){return this.min};a.prototype.getMax=function(){return this.max};a.prototype.getAvg=function(){return this.means};a.prototype.getCovDiag=
function(){return this.covDiag};a.prototype.setMin=function(a){this.min=a};a.prototype.setMax=function(a){this.max=a};a.getCovariance=function(a,b,c){if(2>c)return null;for(var g=a.length,n=new Float64Array(g),l=0;l<g;l++)n[l]=a[l]/c;a=new Float64Array(g*g);var h;h=c/(c-1);for(var k=0,l=0;l<g;l++)for(var t=l;t<g;t++)a[l*g+t]=(b[k]/c-n[l]*n[t])*h,a[t*g+l]=a[l*g+t],k++;return new e.mwg.ml.common.matrix.Matrix(a,g,g)};a.getDistribution=function(a,b,c,g){if(2>c)return null;for(var n=a.length,l=new Float64Array(n),
h=0;h<n;h++)l[h]=a[h]/c;a=new Float64Array(n*n);var k;k=c/(c-1);for(var t=0,h=0;h<n;h++)for(var r=h;r<n;r++)a[h*n+r]=(b[t]/c-l[h]*l[r])*k,a[r*n+h]=a[h*n+r],t++;b=new e.mwg.ml.common.matrix.Matrix(a,n,n);return new e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution(l,b,g)};a.prototype.density=function(a,b){return b?this.getExponentTerm(a):Math.pow(2*Math.PI,-.5*this.rank)*Math.pow(this.det,-.5)*this.getExponentTerm(a)};a.prototype.getExponentTerm=function(a){var b=new Float64Array(a.length);
java.lang.System.arraycopy(a,0,b,0,a.length);for(var c=0;c<a.length;c++)b[c]-=this.means[c];a=new e.mwg.ml.common.matrix.Matrix(b,1,b.length);b=new e.mwg.ml.common.matrix.Matrix(b,b.length,1);a=e.mwg.ml.common.matrix.Matrix.multiply(a,this.inv);b=e.mwg.ml.common.matrix.Matrix.multiply(a,b);return Math.exp(-.5*b.get(0,0))};a.prototype.clone=function(a){a=new e.mwg.ml.common.matrix.operation.MultivariateNormalDistribution(a,null,!1);a.pinvsvd=this.pinvsvd;a.inv=this.inv;a.det=this.det;a.rank=this.rank;
a.covDiag=this.covDiag;return a};return a}();a.MultivariateNormalDistribution=c;c=function(){function a(){}a.prototype.getRank=function(){return this.rank};a.prototype.getDeterminant=function(){return this.det};a.prototype.factor=function(a,b){this._svd=e.mwg.ml.common.matrix.Matrix.defaultEngine().decomposeSVD(a,b);var c=Array(3);c[0]=this._svd.getU();c[1]=this._svd.getSMatrix();c[2]=this._svd.getVt();c=this._svd.getVt();this.S=this._svd.getSMatrix().clone();for(var g=0,n=Math.min(this.S.columns(),
this.S.rows()),l=0;l<n;l++)this.S.get(l,l)>g&&(g=this.S.get(l,l));var h=Math.pow(2,-46)*Math.max(a.columns(),a.rows())*g;this.rank=0;this.det=1;if(0!=g)for(l=0;l<n;l++)g=this.S.get(l,l),g<h?this.S.set(l,l,0):(this.S.set(l,l,1/g),this.det*=g,this.rank++);c=e.mwg.ml.common.matrix.Matrix.multiplyTranspose(e.mwg.ml.common.matrix.TransposeType.TRANSPOSE,c,e.mwg.ml.common.matrix.TransposeType.TRANSPOSE,this.S);this.pinv=e.mwg.ml.common.matrix.Matrix.multiplyTranspose(e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE,
c,e.mwg.ml.common.matrix.TransposeType.TRANSPOSE,this._svd.getU());return this};a.prototype.getSvd=function(){return this._svd};a.prototype.getInvDeterminant=function(){return this.S};a.prototype.getPInv=function(){return this.pinv};return a}();a.PInvSVD=c;c=function(){function a(b){this.degree=0;this.degree=b}a.prototype.getCoef=function(){return this.coef.data()};a.prototype.fit=function(a,b){for(var c=new e.mwg.ml.common.matrix.Matrix(b,b.length,1),g=new e.mwg.ml.common.matrix.Matrix(null,c.rows(),
this.degree+1),n=0;n<b.length;n++)for(var l=1,h=0;h<this.degree+1;h++)g.set(n,h,l),l*=a[n];this.coef=e.mwg.ml.common.matrix.Matrix.defaultEngine().solveQR(g,c,!0,e.mwg.ml.common.matrix.TransposeType.NOTRANSPOSE)};a.extrapolate=function(a,b){for(var c=0,e=1,g=0;g<b.length;g++)c+=b[g]*e,e*=a;return c};return a}();a.PolynomialFit=c})(n.operation||(n.operation={}))})(u.matrix||(u.matrix={}))})(x.common||(x.common={}));(function(u){var t=function(){function e(g,a,c,b){this._capacityFull=0;this._index=
new java.util.HashMap;this._counts=new Int32Array(g);this._values=Array(g);for(var d=0;d<g;d++)this._values[d]=new Float64Array(this._dim);this._dim=a;this._capacity=g;this._lastWeightIsOne=c;this._clearAfterFull=b}e.prototype.insertInside=function(e,a,c,b){var d=this._values[e];d[a]=b;this._counts[e]++;return this._counts[e]==this._dim?(this._clearAfterFull&&this.clearBuffer(e,c),d):null};e.prototype.removeFromBuffer=function(e){var a=this._index.get(e);null!=a&&this.clearBuffer(a,e)};e.prototype.clearBuffer=
function(e,a){this._values[e]=new Float64Array(this._dim);this._counts[e]=0;this._index.remove(a);this._capacityFull--};e.prototype.getArray=function(e,a){var c=this._index.get(e);if(null!=c){var b=this._values[c];a&&this.clearBuffer(c,e);return b}return null};e.prototype.insertArray=function(e,a){var c=this._index.get(e);if(null!=c)java.lang.System.arraycopy(a,0,this._values[c],0,a.length),this._counts[c]=a.length;else{if(this._capacityFull==this._capacity)throw Error("Buffer is full");for(var c=
-1,b=0;b<this._capacity;b++)if(0==this._counts[b]){c=b;break}this._index.put(e,c);java.lang.System.arraycopy(a,0,this._values[c],0,a.length);this._counts[c]=a.length;this._capacityFull++}};e.prototype.insert=function(e,a,c){var b=this._index.get(e);if(null!=b)return this.insertInside(b,a,e,c);if(this._capacityFull==this._capacity)throw Error("Buffer is full");for(var b=-1,d=0;d<this._capacity;d++)if(0==this._counts[d]){b=d;break}this._index.put(e,b);this._lastWeightIsOne&&(this._counts[b]=1,this._values[b][this._dim-
1]=1);return this.insertInside(b,a,e,c)};return e}();u.Buffer=t;t=function(){function n(){}n.getBuffer=function(g,a,c,b,d){if(c==n.INPUT)c=n.inputBuffers;else if(c==n.OUTPUT)c=n.outputBuffers;else if(c==n.INTEGRATION)c=n.integrationBuffers;else if(c==n.ACTIVATION)c=n.activationBuffers;else throw Error("Buffer not recognizable");var m=c.get(g);null==m&&(m=b?new e.mwg.ml.neuralnet.Buffer(n.CAPACITY,a+1,b,d):new e.mwg.ml.neuralnet.Buffer(n.CAPACITY,a,b,d),c.put(g,m));return m};n.CAPACITY=10;n.INPUT=
0;n.OUTPUT=1;n.INTEGRATION=2;n.ACTIVATION=3;n.inputBuffers=new java.util.HashMap;n.outputBuffers=new java.util.HashMap;n.integrationBuffers=new java.util.HashMap;n.activationBuffers=new java.util.HashMap;return n}();u.BufferManager=t;t=function(n){function g(a,c,b,d){n.call(this,a,c,b,d)}__extends(g,n);g.prototype.configure=function(a,c,b,d){var g=new java.util.ArrayList;g.add(this);for(var f=0,n=new java.util.ArrayList,p=0;p<a;p++){var l=this.createNewNode(e.mwg.ml.neuralnet.NeuralNodeType.INPUT);
this.forwardConnect(l);g.add(l);n.add(l)}l=new java.util.ArrayList;f++;for(p=0;p<b;p++){for(var h=0;h<d;h++){var k=this.createNewNode(e.mwg.ml.neuralnet.NeuralNodeType.HIDDEN);l.add(k);g.add(k);for(a=0;a<n.size();a++)n.get(a).forwardConnect(k)}n=l;l=new java.util.ArrayList;f++}for(p=0;p<c;p++){b=this.createNewNode(e.mwg.ml.neuralnet.NeuralNodeType.OUTPUT);for(a=0;a<n.size();a++)n.get(a).forwardConnect(b);b.forwardConnect(this);g.add(b)}for(p=0;p<g.size();p++)g.get(p).initWeightsRadomly(.1),g.get(p).free();
return this};g.prototype.initWeightsRadomly=function(a){var c=this.unphasedState(),b=c.getFromKeyWithDefault(g.NODE_TYPE,e.mwg.ml.neuralnet.NeuralNodeType.HIDDEN);if(b==e.mwg.ml.neuralnet.NeuralNodeType.HIDDEN||b==e.mwg.ml.neuralnet.NeuralNodeType.OUTPUT){for(var b=c.getFromKey(g.INPUTS),b=new Float64Array(b.size()+1),d=0;d<b.length;d++)b[d]=g.random.nextDouble()*a;c.setFromKey(g.WEIGHTS,e.mwg.Type.DOUBLE_ARRAY,b)}};g.prototype.forwardConnect=function(a){var c=this.getOrCreateRel(g.OUTPUTS);c.add(a.id());
c=c.size()-1;this.getOrCreate(g.OUTPUTS_MAP,e.mwg.Type.LONG_TO_LONG_MAP).put(a.id(),c);c=a.getOrCreateRel(g.INPUTS);c.add(this.id());c=c.size()-1;a.getOrCreate(g.INPUTS_MAP,e.mwg.Type.LONG_TO_LONG_MAP).put(this.id(),c)};g.prototype.createNewNode=function(a){var c=this.graph().newTypedNode(this.world(),this.time(),g.NAME);c.setProperty(g.NODE_TYPE,e.mwg.Type.INT,a);return c};g.integrationFct=function(a,c){for(var b=0,d=0;d<c.length;d++)b+=c[d]*a[d];return b};g.activationFunction=function(a,c){return c==
e.mwg.ml.neuralnet.NeuralNodeType.HIDDEN?1/(1+Math.exp(-a)):a};g.derivateActivationFunction=function(a,c,b){return b==e.mwg.ml.neuralnet.NeuralNodeType.HIDDEN?a*(1-a):1};g.calculateErr=function(a,c){return(c-a)*(c-a)/2};g.calculateDerivativeErr=function(a,c){return-(c-a)};g.prototype.propagate=function(a,c,b,d,e,f,n,p){a=c.getFromKey(g.OUTPUTS);for(c=0;c<a.size();c++)this.send(a.get(c),b,d,e,f,n,p)};g.prototype.receive=function(a,c,b,d,m,f,n){var p=this.unphasedState(),l=p.getFromKeyWithDefault(g.NODE_TYPE,
e.mwg.ml.neuralnet.NeuralNodeType.HIDDEN);if(d)if(l==e.mwg.ml.neuralnet.NeuralNodeType.INPUT)this.propagate(this.id(),p,c,b,d,m,f,n);else if(l==e.mwg.ml.neuralnet.NeuralNodeType.HIDDEN||l==e.mwg.ml.neuralnet.NeuralNodeType.OUTPUT){var h=p.getFromKey(g.INPUTS_MAP),k=h.get(a),t=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),h.size(),e.mwg.ml.neuralnet.BufferManager.INPUT,!0,!1),r=t.insert(c,k,b);if(null!=r){b=p.getFromKey(g.WEIGHTS);k=e.mwg.ml.neuralnet.NeuralNode.integrationFct(r,b);a=e.mwg.ml.neuralnet.NeuralNode.activationFunction(k,
l);var h=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),1,e.mwg.ml.neuralnet.BufferManager.INTEGRATION,!1,!1),u=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),1,e.mwg.ml.neuralnet.BufferManager.ACTIVATION,!1,!1);h.insert(c,0,k);u.insert(c,0,a);this.propagate(this.id(),p,c,a,d,m,f,n)}}else{if(l==e.mwg.ml.neuralnet.NeuralNodeType.ROOT){var x=p.getFromKey(g.INPUTS_MAP),k=x.get(a),t=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),x.size(),e.mwg.ml.neuralnet.BufferManager.INPUT,!1,!0),
r=t.insert(c,k,b);m?(d=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),x.size(),e.mwg.ml.neuralnet.BufferManager.OUTPUT,!1,!1),p=d.getArray(c,!1),l=e.mwg.ml.neuralnet.NeuralNode.calculateErr(b,p[k]),h=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),p.length,e.mwg.ml.neuralnet.BufferManager.INTEGRATION,!1,!0),null!=h.insert(c,k,l)&&d.removeFromBuffer(c),this.send(a,c,e.mwg.ml.neuralnet.NeuralNode.calculateDerivativeErr(b,p[k]),!1,m,f,n)):null!=r&&null!=n&&n(r)}}else if(l==e.mwg.ml.neuralnet.NeuralNodeType.INPUT||
l==e.mwg.ml.neuralnet.NeuralNodeType.ROOT){if(h=p.getFromKey(g.OUTPUTS_MAP),k=h.get(a),h=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),h.size(),e.mwg.ml.neuralnet.BufferManager.OUTPUT,!1,!0),r=h.insert(c,k,b),null!=r){if(l==e.mwg.ml.neuralnet.NeuralNodeType.INPUT)for(p=p.getFromKey(g.INPUTS),h=0;h<p.size();h++)this.send(p.get(h),c,b,d,m,f,n);l==e.mwg.ml.neuralnet.NeuralNodeType.ROOT&&null!=n&&n(new Float64Array([c]))}}else if(l==e.mwg.ml.neuralnet.NeuralNodeType.OUTPUT||l==e.mwg.ml.neuralnet.NeuralNodeType.HIDDEN)if(h=
p.getFromKey(g.OUTPUTS_MAP),x=p.getFromKey(g.INPUTS_MAP),k=h.get(a),h=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),h.size(),e.mwg.ml.neuralnet.BufferManager.OUTPUT,!1,!0),r=h.insert(c,k,b),null!=r){b=p.getFromKey(g.WEIGHTS);h=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),1,e.mwg.ml.neuralnet.BufferManager.INTEGRATION,!1,!1);u=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),1,e.mwg.ml.neuralnet.BufferManager.ACTIVATION,!1,!1);t=e.mwg.ml.neuralnet.BufferManager.getBuffer(this.id(),
x.size(),e.mwg.ml.neuralnet.BufferManager.INPUT,!0,!1);k=h.getArray(c,!0);a=u.getArray(c,!0);t=t.getArray(c,!0);r=e.mwg.ml.neuralnet.NeuralNode.integrationFct(r,b);r*=e.mwg.ml.neuralnet.NeuralNode.derivateActivationFunction(a[0],k[0],l);l=new Float64Array(b.length);for(h=0;h<b.length-1;h++)l[h]=b[h]-f*r*t[h];l[b.length-1]=b[b.length-1]-f*r;k=p.getFromKey(g.INPUTS);for(h=0;h<k.size();h++)this.send(k.get(h),c,r*b[h],d,m,f,n);p.setFromKey(g.WEIGHTS,e.mwg.Type.DOUBLE_ARRAY,l)}};g.prototype.send=function(a,
c,b,d,e,f,g){var n=this;this.graph().lookup(this.world(),this.time(),a,function(a){a.receive(n.id(),c,b,d,e,f,g);a.free()})};g.NAME="NeuralNode";g.INPUTS="inputs";g.INPUTS_MAP="inputs_map";g.OUTPUTS="outputs";g.OUTPUTS_MAP="outputs_map";g.WEIGHTS="weights";g.NODE_TYPE="node_type";g.random=new java.util.Random;return g}(e.mwg.plugin.AbstractNode);u.NeuralNode=t;t=function(){function e(){}e.HIDDEN=0;e.INPUT=1;e.OUTPUT=2;e.ROOT=3;return e}();u.NeuralNodeType=t})(x.neuralnet||(x.neuralnet={}))})(z.ml||
(z.ml={}))})(e.mwg||(e.mwg={}))})(org||(org={}));
