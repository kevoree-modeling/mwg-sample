var WebSocketHelper;
(function(g){var h=function(){function c(d,a){void 0===a&&(a=[]);this.debug=!1;this.reconnectInterval=1E3;this.timeoutInterval=2E3;this.timedOut=this.forcedClose=!1;this.protocols=[];this.onopen=function(a){};this.onclose=function(a){};this.onconnecting=function(){};this.onmessage=function(a){};this.onerror=function(a){};this.url=d;this.protocols=a;this.readyState=WebSocket.CONNECTING}c.prototype.connect=function(d){var a=this;this.ws=new WebSocket(this.url,this.protocols);this.ws.binaryType="arraybuffer";
this.onconnecting();this.log("ReconnectingWebSocket","attempt-connect",this.url);var e=this.ws,b=setTimeout(function(){a.log("ReconnectingWebSocket","connection-timeout",a.url);a.timedOut=!0;e.close();a.timedOut=!1},this.timeoutInterval);this.ws.onopen=function(e){clearTimeout(b);a.log("ReconnectingWebSocket","onopen",a.url);a.readyState=WebSocket.OPEN;d=!1;a.onopen(e)};this.ws.onclose=function(e){clearTimeout(b);a.ws=null;a.forcedClose?(a.readyState=WebSocket.CLOSED,a.onclose(e)):(a.readyState=WebSocket.CONNECTING,
a.onconnecting(),d||a.timedOut||(a.log("ReconnectingWebSocket","onclose",a.url),a.onclose(e)),setTimeout(function(){a.connect(!0)},a.reconnectInterval))};this.ws.onmessage=function(e){a.log("ReconnectingWebSocket","onmessage",a.url,e.data);a.onmessage(e)};this.ws.onerror=function(e){a.log("ReconnectingWebSocket","onerror",a.url,e);a.onerror(e)}};c.prototype.send=function(d){if(this.ws)return this.log("ReconnectingWebSocket","send",this.url,d),this.ws.send(d);throw"INVALID_STATE_ERR : Pausing to reconnect websocket";
};c.prototype.close=function(){return this.ws?(this.forcedClose=!0,this.ws.close(),!0):!1};c.prototype.refresh=function(){return this.ws?(this.ws.close(),!0):!1};c.prototype.log=function(){for(var d=[],a=0;a<arguments.length;a++)d[a-0]=arguments[a];(this.debug||c.debugAll)&&console.debug.apply(console,d)};c.debugAll=!1;return c}();g.ReconnectingWebSocket=h})(WebSocketHelper||(WebSocketHelper={}));var org;
(function(g){(function(h){(function(c){var d=function(){function a(a){this.graph=this.ws=null;this.REQ_GET=this.generator=0;this.REQ_PUT=1;this.REQ_LOCK=2;this.REQ_UNLOCK=3;this.REQ_REMOVE=4;this.REQ_UPDATE=5;this.RESP_GET=6;this.RESP_PUT=7;this.RESP_REMOVE=8;this.RESP_LOCK=9;this.RESP_UNLOCK=10;this.url=a;this.callbacks=new java.util.HashMap}a.prototype.connect=function(a,b){this.graph=a;if(null==this.ws){var f=this;this.ws=new WebSocketHelper.ReconnectingWebSocket(this.url);this.ws.onopen=function(a){b(!0)};
this.ws.onmessage=function(a){f.process_rpc_resp(new Int8Array(a.data))};this.ws.connect(!1)}else b(!0)};a.prototype.disconnect=function(a){null!=this.ws&&(this.ws.close(),this.ws=null,a(!0))};a.prototype.get=function(a,b){this.send_rpc_req(this.REQ_GET,a,b)};a.prototype.put=function(a,b){this.send_rpc_req(this.REQ_PUT,a,b)};a.prototype.remove=function(a,b){this.send_rpc_req(this.REQ_REMOVE,a,b)};a.prototype.lock=function(a){this.send_rpc_req(this.REQ_LOCK,null,a)};a.prototype.unlock=function(a,b){this.send_rpc_req(this.REQ_UNLOCK,
a,b)};a.prototype.process_rpc_resp=function(a){var b=this.graph.newBuffer();b.writeAll(a);a=b.iterator();b=a.next();if(null!=b&&0!=b.length()&&(b=b.read(0),b!=this.REQ_UPDATE)){var f=a.next();if(null!=f&&(f=g.mwg.utility.Base64.decodeToIntWithBounds(f,0,f.length()),f=this.callbacks.get(f),null!=f))if(b==this.RESP_GET||b==this.RESP_LOCK){for(var b=this.graph.newBuffer(),d=!0;a.hasNext();)d?d=!1:b.write(g.mwg.Constants.BUFFER_SEP),b.writeAll(a.next().data());f(b)}else f(!0)}};a.prototype.send_rpc_req=
function(a,b,d){if(null==this.ws)throw Error("Not connected!");var c=this.graph.newBuffer();c.write(a);c.write(g.mwg.Constants.BUFFER_SEP);a=this.generator;this.generator+=1;this.callbacks.put(a,d);g.mwg.utility.Base64.encodeIntToBuffer(a,c);null!=b&&(c.write(g.mwg.Constants.BUFFER_SEP),c.writeAll(b.data()));b=c.data();c.free();this.ws.send(b)};return a}();c.WSClient=d})(h.plugin||(h.plugin={}))})(g.mwg||(g.mwg={}))})(org||(org={}));
